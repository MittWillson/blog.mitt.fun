{"meta":{"title":"Mitt's Fun space!","subtitle":null,"description":"Mitt çš„èœé¸¡æŠ€æœ¯åšå®¢ | å¯æ¶çš„Edison","author":"Mitt Willson","url":"https://blog.mitt.fun","root":"/"},"pages":[{"title":"","date":"2021-09-06T11:21:08.661Z","updated":"2021-09-06T11:21:08.661Z","comments":true,"path":"icons/manifest.json","permalink":"https://blog.mitt.fun/icons/manifest.json","excerpt":"","text":"{\"name\":\"App\",\"icons\":[{\"src\":\"/android-icon-36x36.png\",\"sizes\":\"36x36\",\"type\":\"image/png\",\"density\":\"0.75\"},{\"src\":\"/android-icon-48x48.png\",\"sizes\":\"48x48\",\"type\":\"image/png\",\"density\":\"1.0\"},{\"src\":\"/android-icon-72x72.png\",\"sizes\":\"72x72\",\"type\":\"image/png\",\"density\":\"1.5\"},{\"src\":\"/android-icon-96x96.png\",\"sizes\":\"96x96\",\"type\":\"image/png\",\"density\":\"2.0\"},{\"src\":\"/android-icon-144x144.png\",\"sizes\":\"144x144\",\"type\":\"image/png\",\"density\":\"3.0\"},{\"src\":\"/android-icon-192x192.png\",\"sizes\":\"192x192\",\"type\":\"image/png\",\"density\":\"4.0\"}]}"},{"title":"ç•™è¨€æ¿ áƒš(Â°â—•â€µÆ¹â€²â—•áƒš)","date":"2021-02-25T12:33:26.000Z","updated":"2021-09-06T11:21:08.661Z","comments":true,"path":"messages/index.html","permalink":"https://blog.mitt.fun/messages/index.html","excerpt":"","text":"è¿™é‡Œæ˜¯ç•…æ‰€æ¬²è¨€çš„ç•™è¨€æ¿ï¼Œç›¸ä¿¡æ²¡æœ‰æœ‹å‹çš„æˆ‘è¿™é‡Œåº”è¯¥æ˜¯ç©ºçš„å‘¢ :( sad"},{"title":"åŒºå—é“¾ç½‘ç»œèŠ‚ç‚¹","date":"2021-09-06T10:06:00.000Z","updated":"2021-09-06T10:06:00.000Z","comments":true,"path":"networks/index.html","permalink":"https://blog.mitt.fun/networks/index.html","excerpt":"","text":"èŠ‚ç‚¹åç§° ç½‘ç»œ æ¨¡å¼ ID ä¸Šçº¿æ—¶é—´ å¤‡æ³¨ ğŸ¦„ Davalid ğŸŒˆ Adam Darwinia Full Archive 0x7f823f4d93958df4bbe726f933338e6315c953218ed43d69e152df413cd17dd8 2021-09-05"}],"posts":[{"title":"æ³¢å¡é“¾/è¾¾å°”æ–‡é“¾æ²»ç†æ“ä½œå’Œäº‹ä»¶æµç¨‹ç¬”è®° - Updating","slug":"blockchains/substrate-governance-events","date":"2021-08-13T06:19:00.000Z","updated":"2021-08-13T06:19:00.000Z","comments":true,"path":"blockchains/2021/blockchains/substrate-governance-events/","link":"","permalink":"https://blog.mitt.fun/blockchains/2021/blockchains/substrate-governance-events/","excerpt":"pre-post()æœ¬æ–‡ä¸ºç¬”è®°æœ¬è®°å½•ï¼Œä¸»è¦è®°å½• polkadot å’Œ darwinia ç½‘ç»œä¸‹çš„æ²»ç†éƒ¨åˆ†æ“ä½œå’Œäº‹ä»¶è§¦å‘æµç¨‹ï¼Œå†…å®¹æåº¦ä¸å¯ä¿¡ï¼Œä¼šæŒç»­æ›´æ–° å·²å¿½ç•¥è®°å½• Deposit äº‹ä»¶, å¦‚éç‰¹æƒæ“ä½œï¼ŒExtrinsic å‡æ”¶å–æ‰‹ç»­è´¹","text":"pre-post()æœ¬æ–‡ä¸ºç¬”è®°æœ¬è®°å½•ï¼Œä¸»è¦è®°å½• polkadot å’Œ darwinia ç½‘ç»œä¸‹çš„æ²»ç†éƒ¨åˆ†æ“ä½œå’Œäº‹ä»¶è§¦å‘æµç¨‹ï¼Œå†…å®¹æåº¦ä¸å¯ä¿¡ï¼Œä¼šæŒç»­æ›´æ–° å·²å¿½ç•¥è®°å½• Deposit äº‹ä»¶, å¦‚éç‰¹æƒæ“ä½œï¼ŒExtrinsic å‡æ”¶å–æ‰‹ç»­è´¹ åŸè¯è¯å…¸ ä¸­æ–‡ åŸæ„ ææ¡ˆ Proposal åŸè±¡ PreImage ä¸–çºªå‘¨æœŸ ERA æŠµæŠ¼ Staking ç¥¨ Power å…¬æŠ• Referendum æ”¯å‡ºå‘¨æœŸ Spend Period é”€æ¯ Burnt å— Block å»¶è¿Ÿ Delay è®®ä¼š Council æŠ€æœ¯å§”å‘˜ä¼š Tech è´¢æ”¿éƒ¨ Treasury å°è´¹ Treasury Tip æ°‘ä¸»ææ¡ˆ é€’äº¤ææ¡ˆ(æ— åŸè±¡) é€’äº¤éœ€è¦ proposal_hash ä½†æ— éœ€å¯¹å†…å®¹æäº¤ï¼Œè¿™æ˜¯ä¸ºäº†é¿å…ææ¡ˆäººæ”¯å‡ºå¤§é‡è´¹ç”¨ï¼Œå¯åœ¨ç¬¬ä¸‰æ–¹ç”¨ proposal_hash å¯¹ææ¡ˆå†…å®¹è¿›è¡ŒéªŒè¯ä»¥è¯æ˜ææ¡ˆå†…å®¹ä¸€è‡´ Extrinsic: democracy.propose Events: balances.Reserved democracy.Proposed å…¬æŠ• æ¥ä¸‹æ¥è¯·ç§»æ­¥åˆ° å…¬æŠ•éƒ¨åˆ† è®®ä¼šææ¡ˆå‚ä¸ææ¡ˆå’ŒæŠ•ç¥¨çš„æ˜¯è®®ä¼šæˆå‘˜ï¼Œä¹‹åå¦‚æœè½¬ä¸ºå…¬æŠ•åˆ™ä¸ºæŒå¸çš„å…¨æ°‘ é€’äº¤ææ¡ˆ(æ— åŸè±¡) Extrinsic: council.propose Events: council.Proposed æŠ•ç¥¨ æ¯ä¸ªæˆå‘˜æŠ•ç¥¨éƒ½ä¼šäº§ç”Ÿ Voted äº‹ä»¶ Extrinsic: council.vote Events: council.Voted ç»“æŸæŠ•ç¥¨ Extrinsic: technicalcommittee.close Events: technicalcommittee.Closed Member æˆå‘˜ææ¡ˆå¹¶æ‰§è¡Œ ä¼šç›´æ¥æ‰§è¡Œï¼Œä½†å¯èƒ½ä¼šå¤±è´¥ï¼Œå…·ä½“æƒé™æ–¹é¢è¿˜å¾—åœ¨ç ”ç©¶ Extrinsic: council.execute Events: council.MemberExecuted å…¬æŠ•(å¦‚æœææ¡ˆæŠ•ç¥¨ç§»äº¤å…¬æŠ•çš„è¯) æ¥ä¸‹æ¥è¯·ç§»æ­¥åˆ° å…¬æŠ•éƒ¨åˆ† æŠ€æœ¯å§”å‘˜ä¼šææ¡ˆ é€’äº¤ææ¡ˆ(æ— åŸè±¡) Extrinsic: technicalcommittee.propose Events: technicalcommittee.Proposed æŠ€æœ¯å§”å‘˜ä¼šæŠ•ç¥¨ Extrinsic: technicalcommittee.vote Events: technicalcommittee.Voted ç»“æŸæŠ•ç¥¨ Extrinsic: technicalcommittee.close Events: technicalcommittee.Closed å…¬æŠ•(å¦‚æœææ¡ˆæŠ•ç¥¨ç§»äº¤å…¬æŠ•çš„è¯) æ¥ä¸‹æ¥è¯·ç§»æ­¥åˆ° å…¬æŠ•éƒ¨åˆ† è´¢æ”¿éƒ¨ææ¡ˆä¸»è¦ç”¨äºé¡¹ç›®æ‹¨æ¬¾ææ¡ˆï¼Œæ¯”å¦‚å®£ä¼ ã€æŠ€æœ¯è´¹ç”¨ç­‰ é€’äº¤ææ¡ˆ(æ— åŸè±¡) Extrinsic: treasury.propose_spend Events: treasury.Proposed ç§»äº¤ææ¡ˆ Extrinsic: treasury.reject_proposal ä¸è®®ä¼šææ¡ˆç›¸é€šï¼Œæ¥ä¸‹æ¥ä¼šåˆ›å»ºè®®ä¼šææ¡ˆå¹¶èµ°æµç¨‹ æ¥ä¸‹æ¥è¯·ç§»æ­¥åˆ° è®®ä¼šææ¡ˆéƒ¨åˆ† å…¬æŠ•éœ€è¦å…ˆæœ‰ææ¡ˆ ææ¡ˆå·²é€’äº¤å…¬æŠ• Events: balances.Unreserved democracy.Tabled democracy.Started å…¬æ°‘æŠ•ç¥¨(å¼€å§‹) Extrinsic: democracy.vote æäº¤åŸè±¡ Extrinsic: democracy.note_preimage democracy.note_imminent_preimage Events: democracy.PreimageNoted å–æ¶ˆå…¬æŠ•(åˆ†æ”¯) è¿™ä¸ªæƒ…å†µæ¯”è¾ƒç‰¹æ®Šï¼Œå…¶ä¸­æœ‰ä¸€ç§æƒ…å†µï¼Œè®®ä¼šçš„ææ¡ˆå¯ä»¥ç´§æ€¥å–æ¶ˆå…¬æŠ• ç´§æ€¥å–æ¶ˆå…¬æŠ•çš„ææ¡ˆå†…å®¹æ˜¯: democracy.emergency_cancel ref_index Events: democracy.Cancelled ç³»ç»Ÿé€‰ç¥¨(ç»“æŸ) åªæœ‰åœ¨å…¬æŠ•è®¾å®šçš„ç»“æŸæ—¶é—´(å—å’Œå»¶è¿Ÿ)åˆ°æ¥æ‰ä¼šç»“æŸå¹¶ç³»ç»Ÿé€‰ç¥¨ Events: democracy.NotPassed democracy.Passed ææ¡ˆæ‰§è¡Œ Events: democracy.PreimageUsed system.CodeUpdated (å–å†³äºææ¡ˆå†…å®¹) democracy.Excuted","categories":[{"name":"blockchains","slug":"blockchains","permalink":"https://blog.mitt.fun/categories/blockchains/"}],"tags":[{"name":"BlockChains","slug":"BlockChains","permalink":"https://blog.mitt.fun/tags/BlockChains/"},{"name":"Polkadot","slug":"Polkadot","permalink":"https://blog.mitt.fun/tags/Polkadot/"},{"name":"Governance","slug":"Governance","permalink":"https://blog.mitt.fun/tags/Governance/"},{"name":"Darwinia","slug":"Darwinia","permalink":"https://blog.mitt.fun/tags/Darwinia/"},{"name":"Crab","slug":"Crab","permalink":"https://blog.mitt.fun/tags/Crab/"},{"name":"Substrate","slug":"Substrate","permalink":"https://blog.mitt.fun/tags/Substrate/"},{"name":"Notebook","slug":"Notebook","permalink":"https://blog.mitt.fun/tags/Notebook/"}]},{"title":"ã€Šé¢„é˜²æ‰‹æ®‹ Velero é›†ç¾¤å¤‡ä»½éƒ¨ç½² åˆè§ï¼ã€‹","slug":"kubernetes/hello-velero","date":"2021-07-18T10:13:00.000Z","updated":"2021-07-18T10:13:00.000Z","comments":true,"path":"service/kubernetes/2021/kubernetes/hello-velero/","link":"","permalink":"https://blog.mitt.fun/service/kubernetes/2021/kubernetes/hello-velero/","excerpt":"pre-post()è™½ç„¶å¾ˆæ—©ä¹‹å‰å°±æœ‰è¿‡ç”¨ Velero å¯¹K8Sé›†ç¾¤å¤‡ä»½çš„äº†è§£ï¼Œä½†ä¸€ç›´æ²¡æœ‰å®æ–½éƒ¨ç½²ï¼Œå¯¼è‡´ç”±äºæ‰‹æ¬ /BUGå¯¹æˆ‘çš„K8Sé€ æˆäº†ä¸€å®šç¨‹åº¦çš„æ‰“å‡»ï¼Œè™½ç„¶æœ€åä¹Ÿæ¢å¤ä¸šåŠ¡è¿è¡Œäº†ï¼Œä½†ç€å®èŠ±äº†ä¸å°‘æ—¶é—´ï¼Œè€Œä¸”å¦‚æœç¨å¾®ä¸ç•™ç¥å¯èƒ½ä¼šæœ‰å¯¹æ•´ä¸ªä¸šåŠ¡å®•æœºçš„é£é™©ï¼Œæ‰€ä»¥ä»Šå¤©å°±æŠŠ Velero éƒ¨ç½²èµ·æ¥ï¼Œå¹¶è®°å½•ä¸€ä¸‹é‡åˆ°çš„ä¸€äº›é—®é¢˜ æœ¬æ–‡ç¼–å†™ä½¿ç”¨çš„ç¯å¢ƒï¼š OS: macOS BigSurKubernetes: v1.21.2Velero: v1.6.1 æˆ‘ä»¬ç…§ç€å®˜ç½‘çš„æ•™ç¨‹æ¥è¿›è¡Œå®‰è£…ï¼Œç”±äºè¸©è¿‡ç½‘ä¸Šæœçš„æ•™ç¨‹çš„å‘ï¼Œæ‰€ä»¥è¿™é‡Œä»¥æˆ‘æ­£ç¡®å®‰è£…çš„æ­¥éª¤ä¸ºè®°å½•ï¼Œè·³è¿‡éƒ¨åˆ†å‘","text":"pre-post()è™½ç„¶å¾ˆæ—©ä¹‹å‰å°±æœ‰è¿‡ç”¨ Velero å¯¹K8Sé›†ç¾¤å¤‡ä»½çš„äº†è§£ï¼Œä½†ä¸€ç›´æ²¡æœ‰å®æ–½éƒ¨ç½²ï¼Œå¯¼è‡´ç”±äºæ‰‹æ¬ /BUGå¯¹æˆ‘çš„K8Sé€ æˆäº†ä¸€å®šç¨‹åº¦çš„æ‰“å‡»ï¼Œè™½ç„¶æœ€åä¹Ÿæ¢å¤ä¸šåŠ¡è¿è¡Œäº†ï¼Œä½†ç€å®èŠ±äº†ä¸å°‘æ—¶é—´ï¼Œè€Œä¸”å¦‚æœç¨å¾®ä¸ç•™ç¥å¯èƒ½ä¼šæœ‰å¯¹æ•´ä¸ªä¸šåŠ¡å®•æœºçš„é£é™©ï¼Œæ‰€ä»¥ä»Šå¤©å°±æŠŠ Velero éƒ¨ç½²èµ·æ¥ï¼Œå¹¶è®°å½•ä¸€ä¸‹é‡åˆ°çš„ä¸€äº›é—®é¢˜ æœ¬æ–‡ç¼–å†™ä½¿ç”¨çš„ç¯å¢ƒï¼š OS: macOS BigSurKubernetes: v1.21.2Velero: v1.6.1 æˆ‘ä»¬ç…§ç€å®˜ç½‘çš„æ•™ç¨‹æ¥è¿›è¡Œå®‰è£…ï¼Œç”±äºè¸©è¿‡ç½‘ä¸Šæœçš„æ•™ç¨‹çš„å‘ï¼Œæ‰€ä»¥è¿™é‡Œä»¥æˆ‘æ­£ç¡®å®‰è£…çš„æ­¥éª¤ä¸ºè®°å½•ï¼Œè·³è¿‡éƒ¨åˆ†å‘ ç”±äºæˆ‘é‡‡ç”¨çš„æ˜¯ CLI å®‰è£…æ–¹æ³•ï¼Œæ•…å¯èƒ½ç›¸å¯¹ç¹çä¸€äº›ï¼Œå¦‚æœæœ‰å…´è¶£çš„å¯ä»¥ä½¿ç”¨ Helm å®‰è£…ï¼Œè¿™é‡Œç»™å‡ºå®˜æ–¹çš„è¯´æ˜æ–‡æ¡£ https://github.com/vmware-tanzu/helm-charts/blob/main/charts/velero/README.md ä»¥ä¸‹æ“ä½œå‡åœ¨åŒä¸€å‘½åç©ºé—´ velero è¿›è¡Œ subject(â€˜å®‰è£… Velero å‘½ä»¤â€™)macOS with Homebrew1$ brew install velero Windows with Chocolatey1$ choco install velero Linuxä» https://github.com/vmware-tanzu/velero/releases ä¸‹è½½ subject(â€˜å‡†å¤‡S3å­˜å‚¨å‡­è¯â€™)Velero æ”¯æŒå¤šç§å­˜å‚¨æ–¹å¼ï¼Œå¯ä»¥ä»¥è£…æ’ä»¶çš„å½¢å¼æ‰©å±•ï¼Œè¿™é‡Œæˆ‘ç”¨çš„æ˜¯ S3 å…¼å®¹çš„ Minio å‡†å¤‡ä¸€ä¸ªå‡­è¯æ–‡ä»¶ credentials-velero 12345$ cat &gt;&gt; credentials-velero &lt;&lt;EOF[default]aws_access_key_id = &lt;accesskey&gt;aws_secret_access_key = &lt;secretkey&gt;EOF Minio çš„åœ°å€æ˜¯ http://minio.default.svc:9000 Bucket æ˜¯ backupsï¼Œå¹¶ä¸”å·²ç»èµ‹äºˆäº†è¯»å†™æƒé™ subject(â€˜å®‰è£… Veleroâ€™)12345678$ velero install --namespace velero \\ --namespace velero \\ --provider aws \\ --plugins velero/velero-plugin-for-aws:v1.2.0 \\ --bucket backups \\ --secret-file ./credentials-velero \\ --use-volume-snapshots=false \\ --backup-location-config region=minio,s3ForcePathStyle=&quot;true&quot;,s3Url=&quot;http://minio.default.svc:9000&quot;,publicUrl=&quot;&quot; éƒ¨åˆ†å‚æ•°è¯´æ˜: åç§° è¯´æ˜ provider å­˜å‚¨æ’ä»¶ plugins é¢å¤–çš„æ’ä»¶ï¼Œè¿™é‡Œè£…çš„æ˜¯S3æ’ä»¶ï¼Œæˆ‘è¿™é‡Œä½¿ç”¨çš„æ˜¯v1.2.0ï¼Œå»ºè®®æ­£å¼å®‰è£…å‰æŸ¥è¯¢ä¸‹æœ€æ–°çš„ç‰ˆæœ¬æˆ–ä½¿ç”¨ latest ä½œä¸º image tag secret-file å‡­è¯æ–‡ä»¶ï¼Œæä¾›è·¯å¾„ use-volume-snapshots å¯ç”¨å­˜å‚¨å¿«ç…§ï¼Œç”±äºæˆ‘CSIç”¨çš„æœ¬åœ°å­˜å‚¨ä¸æ”¯æŒå¿«ç…§ï¼Œæ‰€ä»¥è®¾ç½®false backup-location-config S3æ’ä»¶é…ç½® éƒ¨åˆ†æ’ä»¶é…ç½®å‚æ•°è¯´æ˜: åç§° è¯´æ˜ s3Url S3 APIåŸŸå publicUrl å…¬å¼€åŸŸåï¼Œç”¨äºä¸‹è½½ç”¨çš„ï¼Œæˆ‘è¿™é‡Œå› ä¸ºæ²¡æœ‰å¤–éƒ¨è®¿é—®æ‰€ä»¥æ²¡è®¾ç½® å…·ä½“çš„æ’ä»¶é…ç½®ä¿¡æ¯å¯ä»¥åœ¨è¿™é‡Œå‚è€ƒ https://github.com/vmware-tanzu/velero-plugin-for-aws/blob/master/backupstoragelocation.md å¯ä»¥é€šè¿‡å‘½ä»¤æ¥æ£€æŸ¥è¿è¡ŒçŠ¶æ€æ˜¯å¦å®‰è£…æˆåŠŸ 1$ kubectl logs deployment/velero -n velero subject(â€˜åˆ›å»ºä¸€ä¸ªä¸ƒç‰›å¤‡ä»½ä½ç½®â€™)å®‰è£… Velero æ—¶ä¼šæä¾›å¹¶åˆ›å»ºä¸€ä¸ªé»˜è®¤çš„å¤‡ä»½ä½ç½®ï¼Œä½†æ˜¯å®é™…æƒ…å†µä¸‹å¯èƒ½ä¼šæœ‰ä¸åŒçš„ä¿å­˜åœ°æ–¹ï¼Œæˆ‘å®‰è£…çš„æ—¶å€™é‡‡ç”¨çš„æ˜¯åœ¨é›†ç¾¤å†…éƒ¨å®‰è£…çš„ minioï¼Œè¿™é‡Œæˆ‘æ·»åŠ  ä¸ƒç‰›OSS å­˜å‚¨æ¥ä¿è¯ä¸ä¼šå› ä¸ºé›†ç¾¤æ¯é¸¡å®•æœºè€Œå¯¼è‡´å¤‡ä»½ä¸¢å¤± è™½ç„¶ Velero æ”¯æŒæ’ä»¶æ‰©å±•å­˜å‚¨ç±»å‹æ”¯æŒï¼Œä½†æ˜¯ç›®å‰ä¸ƒç‰›è¿˜æ²¡æœ‰ Velero çš„æ’ä»¶ï¼Œå¥½åœ¨ä¸ƒç‰›ä¹Ÿæ˜¯ å…¼å®¹S3 çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åªè¦ä½¿ç”¨ aws æ’ä»¶å°±å¯ä»¥äº† åœ¨ç©ºé—´ç®¡ç†é‡Œæ‰¾åˆ° S3åŸŸå å¤åˆ¶é‡Œé¢çš„ Endpoint åŸŸåï¼Œæˆ‘çš„åŸŸåæ˜¯ s3-cn-east-2.qiniucs.com åŒæ ·æˆ‘ä»¬éœ€è¦å…ˆåˆ›å»ºä¸€ä¸ªå‡­è¯æ–‡ä»¶ 12345$ cat &gt;&gt; credentials-velero-qiniu &lt;&lt;EOF[default]aws_access_key_id = &lt;accesskey&gt;aws_secret_access_key = &lt;secretkey&gt;EOF ç„¶åå°†å‡­è¯åˆ›å»ºä¸ºä¸€ä¸ª secret 1$ kubectl create secret generic -n velero credential-qiniu --from-file=qiniu=credentials-velero-qiniu è¿™é‡Œåœ¨ velero å‘½åç©ºé—´åˆ›å»ºä¸€ä¸ªåä¸º credential-qiniu çš„ secretï¼ŒåŒ…å«äº†ä¸€ä¸ª é”®å ä¸º qiniu å€¼ä¸ºæ–‡ä»¶ credentials-velero-qiniu çš„å†…å®¹ æ·»åŠ å­˜å‚¨ä½ç½® 1$ velero backup-location create qiniu --bucket k8s-backup --provider aws --config region=cn-east-2,s3ForcePathStyle=&quot;true&quot;,s3Url=https://s3-cn-east-2.qiniucs.com,publicUrl=&quot;https://download.k8s-backup.com&quot; --credential=credential-qiniu=qiniu --default éƒ¨åˆ†å‚æ•°è¯´æ˜ åç§° è¯´æ˜ credential å‡­è¯secretï¼Œæ ¼å¼ä¸º &lt;secret-name&gt;=&lt;key&gt; default è®¾ç½®ä¸ºé»˜è®¤å­˜å‚¨ä½ç½® æ£€æŸ¥å­˜å‚¨ä½ç½®çŠ¶æ€ 1$ kubectl describe Backupstoragelocations/qiniu -n velero | grep Phase æ˜¾ç¤º Available å°±åˆ›å»ºæˆåŠŸäº† subject(â€˜å°æ’æ›² - å­˜å‚¨ä½ç½®çŠ¶æ€ä¸ºç©ºæˆ–Unavailableâ€™)ç”±äºä¸€å¼€å§‹åœ¨ç½‘ä¸Šæ‰¾äº†å…¶ä»–åšå®¢çš„æ•™ç¨‹è¿›è¡Œå®‰è£…ï¼Œæ‰€ä»¥è¸©äº†ä¸ªå‘ï¼Œè¿™é‡Œè®°å½•ä¸€ä¸‹ï¼Œå¯ä»¥è·³è¿‡è¿™æ®µ å…ˆæ£€æŸ¥ velero è¿è¡Œæ—¥å¿— 1$ kubectl logs -n velero deploy/velero è¿”å›çš„æ—¥å¿—é‡Œæœ‰å¾ˆå¤š errorï¼Œ æˆ‘æ‘˜æŠ„ä¸€æ®µ 1time=&quot;2021-07-18T09:56:11Z&quot; level=error msg=&quot;Error getting a backup store&quot; backup-storage-location=qiniu controller=backup-storage-location error=&quot;rpc error: code = Unknown desc = config has invalid keys [credentialsFile]; valid keys are [region s3Url publicUrl kmsKeyId s3ForcePathStyle signatureVersion profile serverSideEncryption insecureSkipTLSVerify bucket prefix caCert]&quot; error.file=&quot;/go/src/github.com/vmware-tanzu/velero-plugin-for-aws/vendor/github.com/vmware-tanzu/velero/pkg/plugin/framework/validation.go:50&quot; error.function=github.com/vmware-tanzu/velero-plugin-for-aws/vendor/github.com/vmware-tanzu/velero/pkg/plugin/framework.validateConfigKeys logSource=&quot;pkg/controller/backup_storage_location_controller.go:100&quot; è¿™é‡Œå¯ä»¥çœ‹åˆ°ï¼Œé—®é¢˜å‡ºåœ¨æ’ä»¶çš„é…ç½®ä¸Šï¼Œ config has invalid keys [credentialsFile]ï¼Œ è¿™é‡Œé…ç½® credentialsFile ä¸åˆæ³•ï¼Œä½†æ˜¯æˆ‘ä»¬å¹¶æ²¡æœ‰æä¾›è¿™ä¸ªé…ç½®ï¼Œæ‰€ä»¥æˆ‘å»æ‰¾äº†ä¸‹ Velero å’Œ velero-plugin-for-aws çš„ä»“åº“ï¼Œå¹¶è¿½æº¯è¿™ä¸ªå‚æ•°çš„æ¥æº é€šè¿‡æœç´¢æ‰¾åˆ°äº†ä¸€ä¸ª Velero çš„PRï¼Œ #3443 è¿™ä¸ªPRæä¾›äº† Backupstoragelocations çš„å¤–éƒ¨å¤šå‡­è¯æ”¯æŒï¼Œå¹¶ä¸”æ ‡è®°ä¸º v1.6.0 1$ velero version é€šè¿‡å‘½ä»¤æŸ¥è¯¢å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ç‰ˆæœ¬å‘ç°å®‰è£…çš„ç‰ˆæœ¬æ˜¯ v1.6.1ï¼Œ æ‰€ä»¥æ˜¯æ”¯æŒè¿™ä¸ªç‰¹æ€§çš„ æ¥ç€æ‰¾ velero-plugin-for-aws çš„ä»“åº“æºç è·Ÿè¸ª credentialsFile å‘ç°ä¹Ÿåšäº†é€‚é…ï¼Œä½†æ˜¯é€šè¿‡æŸ¥è¯¢ 1$ kubectl describe -n velero deploy/velero åœ¨ Init Containers é‡Œå‘ç° velero-velero-plugin-for-aws çš„ç‰ˆæœ¬æ˜¯ v1.1.0ï¼Œ è€Œç›®å‰æœ€æ–°ç‰ˆæ˜¯ v1.2.0ï¼Œè€Œ credentialsFile é€‚é…ä¹Ÿæ˜¯ v1.2.0 æ‰åšçš„ï¼Œæ‰€ä»¥è¿™é‡Œæ˜¯å› ä¸ºç½‘ä¸Šæ•™ç¨‹å¤ªæ—§å¯¼è‡´å®‰è£…äº†æ—§ç‰ˆå‡ºç°çš„é—®é¢˜ï¼Œé€šè¿‡ä¿®æ”¹ deploy çš„ image ç‰ˆæœ¬è§£å†³äº†è¿™ä¸ªé—®é¢˜ ç°åœ¨æŸ¥è¯¢çŠ¶æ€å°±æ˜¯ Avaliable äº†ï¼Œæ‰€ä»¥è¿™é‡Œå»ºè®®ç”¨ latest ä½œä¸ºæ’ä»¶image tagé¿å…å®‰è£…æ—§ç‰ˆæ’ä»¶äº§ç”Ÿå…¶ä»–é—®é¢˜ subject(â€˜åˆ›å»ºä¸€ä¸ªå¤‡ä»½â€™)åˆ°è¿™é‡Œæ‰€æœ‰é…ç½®éƒ½æå¥½äº†ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¼€å§‹æ‰‹åŠ¨åˆ›å»ºä¸€ä¸ªæ–°å¤‡ä»½äº†ï¼ŒVeleroæ”¯æŒé€‰æ‹©æ€§å¤‡ä»½ï¼Œå¯ä»¥é’ˆå¯¹ç‰¹åˆ«çš„ Namespace, Selector ç­‰è¿›è¡Œå¤‡ä»½ï¼Œæ›´è¯¦ç»†çš„ä»‹ç»å¯ä»¥ç§»æ­¥å®˜æ–¹æ–‡æ¡£ æˆ‘è¿™é‡Œåˆ›å»ºä¸€ä¸ªé»˜è®¤å¤‡ä»½ï¼Œä¼šå¤‡ä»½é›†ç¾¤çš„æ‰€æœ‰æè¿°æ–‡ä»¶ 1$ velero backup create first æŸ¥è¯¢å¤‡ä»½çŠ¶æ€ 1$ velero backup describe first | grep Phase æ˜¾ç¤º Completed å°±å·²ç»å¤‡ä»½å®Œæˆäº†ï¼Œå¯ä»¥åœ¨Bucketé‡Œçœ‹åˆ°å·²ç»ä¸Šä¼ çš„å¤‡ä»½æ–‡ä»¶ ä¸‹è½½å¤‡ä»½ æˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡ä¸Šè¿°é…ç½®çš„ publicUrl ä¸‹è½½æˆ‘ä»¬çš„å¤‡ä»½æ–‡ä»¶å’Œå¤‡ä»½æ—¥å¿— 1$ velero backup download first ç„¶åå°±ä¸‹è½½åˆ°æœ¬åœ°äº†ï¼Œä¹Ÿå¯ä»¥è‡ªå·±æ‰‹åŠ¨å»å¯¹è±¡å­˜å‚¨é‡Œä¸‹è½½ subject(â€˜Endâ€™)åˆ°è¿™é‡Œåˆæ­¥çš„ä½“éªŒå°±ç»“æŸäº†ï¼ŒVelero åç»­çš„è¿˜æœ‰ Volume å¤‡ä»½ï¼ˆä¸éœ€è¦å¿«ç…§æ”¯æŒ)ï¼Œå®šæ—¶å¤‡ä»½ç­‰ï¼Œ æ›´è¯¦ç»†çš„åŠŸèƒ½å¯ä»¥ç§»æ­¥å®˜æ–¹æ–‡æ¡£æŸ¥çœ‹","categories":[{"name":"service","slug":"service","permalink":"https://blog.mitt.fun/categories/service/"},{"name":"kubernetes","slug":"service/kubernetes","permalink":"https://blog.mitt.fun/categories/service/kubernetes/"}],"tags":[{"name":"Kubernetes","slug":"Kubernetes","permalink":"https://blog.mitt.fun/tags/Kubernetes/"},{"name":"K8S","slug":"K8S","permalink":"https://blog.mitt.fun/tags/K8S/"},{"name":"K3S","slug":"K3S","permalink":"https://blog.mitt.fun/tags/K3S/"},{"name":"Velero","slug":"Velero","permalink":"https://blog.mitt.fun/tags/Velero/"}]},{"title":"å…³äº ã€Šæˆ‘è¢«K8Sè¹‚èºåƒç™¾éã€‹çš„é‚£äº›äº‹","slug":"kubernetes/issues-of-k8s","date":"2021-04-16T22:49:00.000Z","updated":"2021-04-16T22:49:00.000Z","comments":true,"path":"service/kubernetes/2021/kubernetes/issues-of-k8s/","link":"","permalink":"https://blog.mitt.fun/service/kubernetes/2021/kubernetes/issues-of-k8s/","excerpt":"è®°å½•ä¸€äº›æˆ‘é‡åˆ°çš„K8Så’ŒDockerçš„é—®é¢˜ä»¥åŠç›¸åº”çš„è§£å†³æ–¹æ¡ˆ","text":"è®°å½•ä¸€äº›æˆ‘é‡åˆ°çš„K8Så’ŒDockerçš„é—®é¢˜ä»¥åŠç›¸åº”çš„è§£å†³æ–¹æ¡ˆ é—®é¢˜åˆ—è¡¨WARN No swap limit support 12345678$ sudo vim /etc/default/grub# è¿½åŠ ä»¥ä¸‹å†…å®¹# å¦‚æœå­˜åœ¨è¯¥å˜é‡åˆ™åªè¿½åŠ å†…å®¹GRUB_CMDLINE_LINUX=&quot;cgroup_enable=memory swapaccount=1&quot;$ sudo update-grub# éœ€è¦é‡å¯ç”Ÿæ•ˆ failed to allocate for range 0: no IP addresses available in range set: 172.32.xx.1-172.32.xx.254 123$ rm -rf /var/lib/cni/networks/*$ systemctl restart containerd$ systemctl restart kubelet Warning: Stopping docker.service, but it can still be activated by: docker.socket 1$ rm -rf /lib/systemd/system/docker.socket","categories":[{"name":"service","slug":"service","permalink":"https://blog.mitt.fun/categories/service/"},{"name":"kubernetes","slug":"service/kubernetes","permalink":"https://blog.mitt.fun/categories/service/kubernetes/"}],"tags":[{"name":"Kubernetes","slug":"Kubernetes","permalink":"https://blog.mitt.fun/tags/Kubernetes/"},{"name":"K8S","slug":"K8S","permalink":"https://blog.mitt.fun/tags/K8S/"},{"name":"K3S","slug":"K3S","permalink":"https://blog.mitt.fun/tags/K3S/"},{"name":"Issues","slug":"Issues","permalink":"https://blog.mitt.fun/tags/Issues/"}]},{"title":"å¿«é€Ÿæ‰©å®¹ Node çš„ podCIDR IPèŒƒå›´","slug":"kubernetes/node-ip-cidr-extends","date":"2021-04-16T22:49:00.000Z","updated":"2021-06-11T20:09:00.000Z","comments":true,"path":"service/kubernetes/2021/kubernetes/node-ip-cidr-extends/","link":"","permalink":"https://blog.mitt.fun/service/kubernetes/2021/kubernetes/node-ip-cidr-extends/","excerpt":"pre-post()ä¸ºäº†æ›´å¥½çš„å‹æ¦¨èŠ‚ç‚¹(å› ä¸ºç©·ä¹°ä¸èµ·ç¬¬äºŒå°), æ‰€ä»¥åœ¨å•å°æœºå™¨ä¸Šè·‘äº†æ›´å¤šçš„æœåŠ¡ï¼Œä»è€Œå¯¼è‡´äº†æ›´å¤šçš„podéœ€è¦IPåˆ†é…ï¼Œè€Œè¶…é‡åˆ™äº§ç”Ÿäº†ä¸€ä¸ªå¼‚å¸¸ failed to allocate for range 0: no IP addresses available in range set, èŠ‚ç‚¹é»˜è®¤å®‰è£…ä¸‹æ¥æ˜¯ /16 çš„æ®µï¼Œè€Œæ¯ä¸ªèŠ‚ç‚¹ä¼šåˆ†åˆ° /24 æ®µï¼Œè¿™æ„å‘³ç€æ¯ä¸ªèŠ‚ç‚¹æœ€å¤šå¯åˆ†é… 256 ä¸ª POD IPï¼Œè¿™å¯¹äºæˆ‘è¿™ç§ç²¾æ‰’çš®æ¥è¯´è¿œè¿œä¸å¤Ÿï¼Œæ‰€ä»¥å°±éœ€è¦å¯¹èŠ‚ç‚¹çš„IPæ®µè¿›è¡Œæ‰©å®¹ï¼Œè®©æ¯ä¸ªèŠ‚ç‚¹èƒ½åˆ†åˆ°æ›´å¤šçš„IP","text":"pre-post()ä¸ºäº†æ›´å¥½çš„å‹æ¦¨èŠ‚ç‚¹(å› ä¸ºç©·ä¹°ä¸èµ·ç¬¬äºŒå°), æ‰€ä»¥åœ¨å•å°æœºå™¨ä¸Šè·‘äº†æ›´å¤šçš„æœåŠ¡ï¼Œä»è€Œå¯¼è‡´äº†æ›´å¤šçš„podéœ€è¦IPåˆ†é…ï¼Œè€Œè¶…é‡åˆ™äº§ç”Ÿäº†ä¸€ä¸ªå¼‚å¸¸ failed to allocate for range 0: no IP addresses available in range set, èŠ‚ç‚¹é»˜è®¤å®‰è£…ä¸‹æ¥æ˜¯ /16 çš„æ®µï¼Œè€Œæ¯ä¸ªèŠ‚ç‚¹ä¼šåˆ†åˆ° /24 æ®µï¼Œè¿™æ„å‘³ç€æ¯ä¸ªèŠ‚ç‚¹æœ€å¤šå¯åˆ†é… 256 ä¸ª POD IPï¼Œè¿™å¯¹äºæˆ‘è¿™ç§ç²¾æ‰’çš®æ¥è¯´è¿œè¿œä¸å¤Ÿï¼Œæ‰€ä»¥å°±éœ€è¦å¯¹èŠ‚ç‚¹çš„IPæ®µè¿›è¡Œæ‰©å®¹ï¼Œè®©æ¯ä¸ªèŠ‚ç‚¹èƒ½åˆ†åˆ°æ›´å¤šçš„IP ä¿®æ”¹Nodeç”±äº Node ä¿¡æ¯æ— æ³•ç›´æ¥ä¿®æ”¹ï¼Œè¿™é‡Œé‡‡å–ä¸€ç§å˜ç›¸æªæ–½ï¼ˆæœ‰ä¸€å®šé£é™©ï¼Œè‡ªå·±æ‰¿æ‹…ï¼‰ï¼Œä¿å­˜Nodeçš„é…ç½®ï¼Œä¿®æ”¹Nodeä¸­PodCIDRä¿¡æ¯ï¼Œç„¶ååˆ é™¤æ‰Nodeèµ„æºï¼Œè¶Kubeletè¿˜æ²¡æœ‰ååº”è¿‡æ¥å°±å·å·æŠŠä¿®æ”¹è¿‡çš„Nodeèµ„æºåŠ å›å» ä¿å­˜ node.yaml 1$ kubectl get node test-worker -o yaml &gt; node.yaml ä¿®æ”¹ node.yaml çš„ podCIDR 123456...spec: podCIDR: 10.32.2.0/22 podCIDRs: - 10.32.2.0/22... è¿™é‡Œæˆ‘ä»¬åªéœ€è¦æ”¹ä¸º 22 å°±èƒ½è®©æ¯ä¸ªèŠ‚ç‚¹podçš„IPå¯ç”¨æ•°é‡ç¿»å€å¾—åˆ° 1022 ä¸ªIPï¼Œå¯¹æˆ‘æ¥è¯´å°±è¶³å¤Ÿç”¨äº† åˆ é™¤ node ä¿¡æ¯ 1$ kubectl delete node test-worker å¯¼å…¥èŠ‚ç‚¹ 1$ kubectl apply -f ./node.yaml ç„¶åå°±å®Œæˆäº†ï¼Œåˆ›å»ºæ–°podçš„æ—¶å€™ï¼Œå°±ä¼šä»podCIDRå’ŒIPç¼“å­˜æ–‡ä»¶ä¿¡æ¯é‡Œæ‰¾å¯ç”¨IPåˆ›å»ºï¼Œï¼ˆä¸è¿‡å¥‡æ€ªçš„æ˜¯æˆ‘çš„podå¹¶æ²¡æœ‰è¶…è¿‡200ï¼Œä½†ä¾ç„¶å‡ºç°IPæ± çŸ­ç¼ºçš„é—®é¢˜ï¼Œå¯èƒ½æ˜¯flannelåœ¨é”€æ¯podåå¹¶æ²¡æœ‰é”€æ¯IPä¿¡æ¯ï¼Œå¯¼è‡´IPä¸€ç›´è¢«å ç”¨ï¼‰","categories":[{"name":"service","slug":"service","permalink":"https://blog.mitt.fun/categories/service/"},{"name":"kubernetes","slug":"service/kubernetes","permalink":"https://blog.mitt.fun/categories/service/kubernetes/"}],"tags":[{"name":"Kubernetes","slug":"Kubernetes","permalink":"https://blog.mitt.fun/tags/Kubernetes/"},{"name":"K8S","slug":"K8S","permalink":"https://blog.mitt.fun/tags/K8S/"},{"name":"K3S","slug":"K3S","permalink":"https://blog.mitt.fun/tags/K3S/"},{"name":"Issues","slug":"Issues","permalink":"https://blog.mitt.fun/tags/Issues/"},{"name":"Flannel","slug":"Flannel","permalink":"https://blog.mitt.fun/tags/Flannel/"}]},{"title":"åˆ©ç”¨ Cloudflare Workers åˆ›å»ºä¸€ä¸ªè·³è½¬å‹é“¾æœåŠ¡(ä¹ä¸çº§ç®€æ˜“ç‰ˆ)","slug":"script/cf-workers-redirect-to-friends","date":"2021-03-03T12:33:09.000Z","updated":"2021-03-03T12:33:09.000Z","comments":true,"path":"scripts/2021/script/cf-workers-redirect-to-friends/","link":"","permalink":"https://blog.mitt.fun/scripts/2021/script/cf-workers-redirect-to-friends/","excerpt":"pre-post()æ°´äº†å‡ ç¯‡åšæ–‡èƒ†å­è‚¥äº†èµ·æ¥ï¼Œå¼€å§‹åˆ°å¤„äº¤æ¢å‹é“¾ï¼Œä½†æ˜¯æƒ³åˆ›å»ºä¸€ä¸ªç®€ä¾¿æ˜“ç»´æŠ¤çš„å‹é“¾æœåŠ¡ï¼Œå‰æœŸå…ˆå®ç°èƒ½è·³è½¬åˆ°ç›®æ ‡é“¾æ¥ï¼ŒåæœŸæƒ³èƒ½æ‰©å±•æ‰©å±•æ”¯æŒç›‘æ§å‹é“¾ç›®æ ‡ç½‘ç«™çš„æœ‰æ•ˆçŠ¶æ€ï¼Œç»“åˆé€šçŸ¥æ¥å®ç°æŠ¥è­¦ï¼Œä½†æœ¬ç¯‡åªå®ç°äº† èƒ½ç”¨ ï¼ˆé€ƒï¼Œå¦‚æœæ²¡å’•å’•å’•çš„è¯ä»¥åä¼šå‡çº§ä»£ç å¹¶æ”¯æŒæ›´é«˜çº§çš„åŠŸèƒ½ç„¶åå†æ°´ä¸€ç¯‡å‘å¸ƒæ–°æ–‡ç« æ¥ä»‹ç»ã€‚ æ›´æ–°æ—¥æœŸ: 2021-03-03","text":"pre-post()æ°´äº†å‡ ç¯‡åšæ–‡èƒ†å­è‚¥äº†èµ·æ¥ï¼Œå¼€å§‹åˆ°å¤„äº¤æ¢å‹é“¾ï¼Œä½†æ˜¯æƒ³åˆ›å»ºä¸€ä¸ªç®€ä¾¿æ˜“ç»´æŠ¤çš„å‹é“¾æœåŠ¡ï¼Œå‰æœŸå…ˆå®ç°èƒ½è·³è½¬åˆ°ç›®æ ‡é“¾æ¥ï¼ŒåæœŸæƒ³èƒ½æ‰©å±•æ‰©å±•æ”¯æŒç›‘æ§å‹é“¾ç›®æ ‡ç½‘ç«™çš„æœ‰æ•ˆçŠ¶æ€ï¼Œç»“åˆé€šçŸ¥æ¥å®ç°æŠ¥è­¦ï¼Œä½†æœ¬ç¯‡åªå®ç°äº† èƒ½ç”¨ ï¼ˆé€ƒï¼Œå¦‚æœæ²¡å’•å’•å’•çš„è¯ä»¥åä¼šå‡çº§ä»£ç å¹¶æ”¯æŒæ›´é«˜çº§çš„åŠŸèƒ½ç„¶åå†æ°´ä¸€ç¯‡å‘å¸ƒæ–°æ–‡ç« æ¥ä»‹ç»ã€‚ æ›´æ–°æ—¥æœŸ: 2021-03-03 reuqired(â€˜ä¾èµ–â€™)éœ€è¦åšä»¥ä¸‹æ­¥éª¤ åˆ›å»ºä¸€ä¸ª KV ä»“åº“ åˆ›å»ºä¸€ä¸ª Worker å°† KV å…³è”åˆ° Worker å¹¶å‘½åä¸º FRIENDS å°† ä»£ç æœ¬ä½“ å¤åˆ¶åˆ° Worker code(â€˜ä»£ç æœ¬ä½“â€™)123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657addEventListener(&#x27;fetch&#x27;, event =&gt; &#123; event.respondWith(handleRequest(event.request))&#125;)const domains = &#123; get(name) &#123; return FRIENDS.get(name); &#125;&#125;;/** * Respond to the request * @param &#123;Request&#125; request */async function handleRequest(request) &#123; const url = new URL(request.url); const host = url.host; const path = url.pathname; let friendName = (host.match(/^(.*?)(?=\\.)/g) || [])[0]; let redirect = null; // friends.mitt.fun/&#123;name&#125; if (friendName === &#x27;friends&#x27;) &#123; const r = /^\\/?([^\\/]*)\\/?(.*?)$/g.exec(path) || []; if (path.match(/^\\/?$/g)) &#123; return indexPage(); &#125; friendName = r[1]; const fUrl = await domains.get(friendName); if (fUrl) &#123; redirect = fUrl.replace(/\\/$/g, &#x27;&#x27;) + &#x27;/&#x27; + (r[2] || &#x27;&#x27;); &#125; &#125; else &#123; const fUrl = await domains.get(friendName); if (fUrl) &#123; redirect = fUrl.replace(/\\/$/g, &#x27;&#x27;) + path; &#125; &#125; if (!redirect) &#123; return noFriendAnyMore(friendName); &#125; return redirectTo(friendName, redirect);&#125;function noFriendAnyMore(friendName) &#123; return new Response(`Sorry, $&#123;friendName || &#x27;this one&#x27;&#125; is not be my firends anymore.`, &#123;status: 200&#125;);&#125;function redirectTo(friendName, url) &#123; return new Response(&#x27;You are going to Mitt\\&#x27;s friend\\&#x27;s area&#x27;, &#123;status: 302, headers: &#123;location: url&#125;&#125;)&#125;function indexPage() &#123; return new Response(`Hi there, this is Mitt&#x27;s Friends redirector, nice to see you :)`)&#125; subject(â€˜ç›®å‰åŠŸèƒ½ä»‹ç»â€™)ç›®å‰å®ç°ä»¥ä¸‹ä¸¤ç§è®¿é—®æ–¹å¼ https://{KEY}.mitt.fun é€šè¿‡åŸŸåæœ€åº•å±‚çš„åå­— &#123;KEY&#125; æ¥å…³è” KV æœåŠ¡ä¸­çš„ Key å€¼ ä½ å¯ä»¥å®šä¹‰ä»»ä½•å±‚çº§çš„åŸŸåï¼Œåªè¦æœ€å¤–é¢æ˜¯ &#123;KEY&#125; å°±å¯ä»¥äº†, æ¯”å¦‚ https://&#123;KEY&#125;.friends.of.mine.mitt.fun ä¹ŸåŒæ ·ä¼šåŒ¹é… https://friends.mitt.fun/{KEY} é€šè¿‡è®¿é—® Path çš„ç¬¬ä¸€å±‚ &#123;KEY&#125; æ¥å…³è” KV æœåŠ¡ä¸­çš„ Key å€¼ ä»¥ä¸Šçš„ä¸¤ç§æ–¹å¼éƒ½æ”¯æŒä¼ é€’è·¯å¾„ï¼Œå³é€šè¿‡åœ¨åé¢è·Ÿä¸Š /xxxx æ¥è½¬å‘åˆ°ç›®æ ‡ç½‘å€çš„ /xxxx subject(â€˜exampleâ€™)è‡ªå®šä¹‰åŸŸåæ–¹å¼è½¬å‘: å…³è” edison.mitt.fun åŸŸååˆ°åˆ›å»ºçš„ Worker åœ¨ KV æœåŠ¡ä¸­å¡«å†™ Key ä¸º edison, Value ä¸º https://www.wevg.org æµ‹è¯•è®¿é—® https://edison.mitt.fun ä¼š302è·³è½¬åˆ° https://www.wevg.org æµ‹è¯•è®¿é—® https://edison.mitt.fun/friends/ ä¼š302è·³è½¬åˆ° https://www.wevg.org/friends/ ç›®å½•æ–¹å¼è½¬å‘: å…³è” friends.mitt.fun åŸŸååˆ°åˆ›å»ºçš„ Worker åœ¨ KV æœåŠ¡ä¸­å¡«å†™ Key ä¸º peter, Value ä¸º https://pzhang.net/ æµ‹è¯•è®¿é—® https://friends.mitt.fun/peter ä¼š302è·³è½¬åˆ° https://pzhang.net/ æµ‹è¯•è®¿é—® https://friends.mitt.fun/peter/archives/ ä¼š302è·³è½¬åˆ° https://pzhang.net/archives/ end()åˆæ°´äº†ä¸€ç¯‡ï¼Œå¥½å”‰ã€‚ (åˆ«é—®æˆ‘ä¸ºå•¥æŸäººä¸åœ¨ Links","categories":[{"name":"scripts","slug":"scripts","permalink":"https://blog.mitt.fun/categories/scripts/"}],"tags":[{"name":"Cloudflare","slug":"Cloudflare","permalink":"https://blog.mitt.fun/tags/Cloudflare/"},{"name":"Scripts","slug":"Scripts","permalink":"https://blog.mitt.fun/tags/Scripts/"},{"name":"Friends","slug":"Friends","permalink":"https://blog.mitt.fun/tags/Friends/"}]},{"title":"åŸŸåè§£æä½¿MXå’ŒCNAMEå…±å­˜ è§£å†³åŸŸåé‚®ç®±æ”¶å‘ä»¶é—®é¢˜","slug":"domain/dns-mx-cname-coexist","date":"2021-02-26T20:12:22.000Z","updated":"2021-02-27T13:40:22.000Z","comments":true,"path":"dns/2021/domain/dns-mx-cname-coexist/","link":"","permalink":"https://blog.mitt.fun/dns/2021/domain/dns-mx-cname-coexist/","excerpt":"pre-post()å› ä¸ºæˆ‘è‡ªå·±æäº†ä¸€ä¸ªåŸŸåé‚®ç®±ï¼Œç”¨çš„è…¾è®¯ä¼ä¸šé‚®ç®±ï¼Œä¹‹å‰ä¸ºäº†ä¸Šå›½å†…CDNä»Cloudflare è¿ç§»å‡ºæ¥æ¢æˆ Cloudflare Partnerï¼Œç”¨ DNSPOD å®ç° GEODNSï¼Œå›½å†…ç”¨ ç™¾åº¦CDNï¼Œå›½å¤–ç”¨ Cloudflareï¼Œé€šè¿‡ CNAME è§£ææŒ‡å‘ï¼Œä½†æ˜¯åé¢å‘ç°ä¸€ä¸ªé—®é¢˜å°±æ˜¯åŸŸåé‚®ç®±çªç„¶æ— æ³•æ­£å¸¸æ”¶å‘é‚®ä»¶äº†ï¼Œç½‘ä¸Šé€šè¿‡è°·æ­Œå’Œå…¶ä»–åšä¸»çš„åšæ–‡å¾—çŸ¥è¿™æ˜¯DNSçš„ç‰¹æ€§å¯¼è‡´çš„(å‚è€ƒ5)ï¼Œå¦‚æœæƒ³è¦è§£å†³å°±åªèƒ½A+MXçš„å…±å­˜æ–¹å¼ï¼Œä½†æ˜¯æ˜¾ç„¶è¿™ç§æ–¹å¼å¯¹æˆ‘æ¥è¯´å¼Šç«¯å¾ˆå¤šï¼Œå¦ä¸€ç§æ–¹æ¡ˆå°±æ˜¯å°†ç½‘ç«™è§£æåˆ°wwwå­åŸŸåï¼ŒæŠŠ@è…¾å‡ºæ¥ç»™MXï¼Œæˆ–è€…å°†åŸŸåé‚®ç®±è§£æåˆ° mail å­åŸŸåï¼Œè™½ç„¶å¯¹å¤§éƒ¨åˆ†äººæ¥è¯´å¯è¡Œï¼Œä½†æ˜¯å¯¹æˆ‘æœ‰ç‚¹å¼ºè¿«ç—‡ï¼Œæˆ‘å°±æƒ³ç”¨@ï¼Œæ¯•ç«Ÿchromeéƒ½æ¨¡ç³ŠåŒ–wwwå’Œ@äº†ï¼Œè‡ªç„¶æ˜¯@æ›´é€‚åˆä¸€ç‚¹ï¼Œæ¥ä¸‹æ¥çš„æ–¹æ³•å°±æ˜¯æˆ‘è‡ªå·±çé¼“æ£å‡ºæ¥çš„ï¼Œä½†æ˜¯åˆæ²¡æœ‰æŸ¥è¯¢ç›¸å…³èµ„æ–™è¯æ˜100%ä¸ä¼šå‡ºé—®é¢˜ï¼Œä½†åˆ°ç›®å‰æ¥çœ‹è¿˜æ˜¯å¾ˆç¨³çš„ï¼Œä¹Ÿä¸ç¡®å®šæ”¾åˆ°å…¶ä»–DNSæœåŠ¡å•†ä»¥åŠå…¶ä»–CDNæœåŠ¡å•†æ˜¯å¦åŒæ ·æœ‰æ•ˆã€‚","text":"pre-post()å› ä¸ºæˆ‘è‡ªå·±æäº†ä¸€ä¸ªåŸŸåé‚®ç®±ï¼Œç”¨çš„è…¾è®¯ä¼ä¸šé‚®ç®±ï¼Œä¹‹å‰ä¸ºäº†ä¸Šå›½å†…CDNä»Cloudflare è¿ç§»å‡ºæ¥æ¢æˆ Cloudflare Partnerï¼Œç”¨ DNSPOD å®ç° GEODNSï¼Œå›½å†…ç”¨ ç™¾åº¦CDNï¼Œå›½å¤–ç”¨ Cloudflareï¼Œé€šè¿‡ CNAME è§£ææŒ‡å‘ï¼Œä½†æ˜¯åé¢å‘ç°ä¸€ä¸ªé—®é¢˜å°±æ˜¯åŸŸåé‚®ç®±çªç„¶æ— æ³•æ­£å¸¸æ”¶å‘é‚®ä»¶äº†ï¼Œç½‘ä¸Šé€šè¿‡è°·æ­Œå’Œå…¶ä»–åšä¸»çš„åšæ–‡å¾—çŸ¥è¿™æ˜¯DNSçš„ç‰¹æ€§å¯¼è‡´çš„(å‚è€ƒ5)ï¼Œå¦‚æœæƒ³è¦è§£å†³å°±åªèƒ½A+MXçš„å…±å­˜æ–¹å¼ï¼Œä½†æ˜¯æ˜¾ç„¶è¿™ç§æ–¹å¼å¯¹æˆ‘æ¥è¯´å¼Šç«¯å¾ˆå¤šï¼Œå¦ä¸€ç§æ–¹æ¡ˆå°±æ˜¯å°†ç½‘ç«™è§£æåˆ°wwwå­åŸŸåï¼ŒæŠŠ@è…¾å‡ºæ¥ç»™MXï¼Œæˆ–è€…å°†åŸŸåé‚®ç®±è§£æåˆ° mail å­åŸŸåï¼Œè™½ç„¶å¯¹å¤§éƒ¨åˆ†äººæ¥è¯´å¯è¡Œï¼Œä½†æ˜¯å¯¹æˆ‘æœ‰ç‚¹å¼ºè¿«ç—‡ï¼Œæˆ‘å°±æƒ³ç”¨@ï¼Œæ¯•ç«Ÿchromeéƒ½æ¨¡ç³ŠåŒ–wwwå’Œ@äº†ï¼Œè‡ªç„¶æ˜¯@æ›´é€‚åˆä¸€ç‚¹ï¼Œæ¥ä¸‹æ¥çš„æ–¹æ³•å°±æ˜¯æˆ‘è‡ªå·±çé¼“æ£å‡ºæ¥çš„ï¼Œä½†æ˜¯åˆæ²¡æœ‰æŸ¥è¯¢ç›¸å…³èµ„æ–™è¯æ˜100%ä¸ä¼šå‡ºé—®é¢˜ï¼Œä½†åˆ°ç›®å‰æ¥çœ‹è¿˜æ˜¯å¾ˆç¨³çš„ï¼Œä¹Ÿä¸ç¡®å®šæ”¾åˆ°å…¶ä»–DNSæœåŠ¡å•†ä»¥åŠå…¶ä»–CDNæœåŠ¡å•†æ˜¯å¦åŒæ ·æœ‰æ•ˆã€‚ subject(â€˜å®ç°ç›®æ ‡â€™)èƒ½å¤Ÿä½¿ç”¨ DNSPOD ä½¿ pwecho.com æ”¯æŒå¢ƒå†…å¢ƒå¤–ä¸åŒCDNæœåŠ¡ Cloudflare å’Œ BaiduCDNï¼ŒåŒæ—¶å…¼å®¹ è…¾è®¯ä¼ä¸šé‚®ç®± subject(â€˜å½“å‰é…ç½®â€™) Cloudflare Partner Name Type Record Remark @ CNAME s-ip.pwecho.com ç½‘ç«™æœåŠ¡å™¨ ä½¿ç”¨ s-ip.pwecho.com æ–¹ä¾¿æ›´æ”¹IPï¼ŒCDNéœ€è¦CNAMEæŒ‡å‘ s-ip.pwecho.com DNSPOD Name Type Record Region Remark s-ip A x.x.x.x ç½‘ç«™æœåŠ¡å™¨æºç«™IP @ MX mx1.qq.com é»˜è®¤ è…¾è®¯ä¼ä¸šé‚®ç®± @ MX mx2.qq.com é»˜è®¤ è…¾è®¯ä¼ä¸šé‚®ç®± @ CNAME pwecho.com.cdn.cloudflare.com å¢ƒå¤– Cloudflare @ CNAME pwecho.com.a.bdydns.com å¢ƒå†… BaiduCDN è™½ç„¶ DNSPOD æ”¯æŒMXå’ŒCNAMEåŒæ—¶è®°å½•ï¼Œä¼šæç¤ºå¯èƒ½ä¼šäº§ç”Ÿä¸å…¼å®¹é—®é¢˜ï¼Œä½†å¯ä»¥å¿½ç•¥ï¼Œå®é™…æµ‹è¯•ä¼šå‡ºç°æ— æ³•æ­£å¸¸è¿”å›MXçš„æƒ…å†µ subject(â€˜è§£å†³æ–¹æ¡ˆâ€™)ç›®å‰çš„è§£å†³æ–¹æ¡ˆæ˜¯ï¼Œå•ç‹¬å‰¥ç¦»ä¸€ä¸ªCNAMEï¼Œå¢ƒå¤–è®© Cloudflare è´Ÿè´£æä¾›MXå’ŒAè®°å½•ï¼Œå¢ƒå†…è®© DNSPOD æä¾›ï¼Œä»¥ä¸‹æ˜¯ä¿®æ”¹æ–¹æ¡ˆ Cloudflare Partner Name Type Record Remark @ CNAME s-ip.pwecho.com ç½‘ç«™æœåŠ¡å™¨ @ MX mx1.qq.com è…¾è®¯ä¼ä¸šé‚®ç®± @ MX mx2.qq.com è…¾è®¯ä¼ä¸šé‚®ç®± DNSPOD Name Type Record Region Remark s-ip A x.x.x.x ç½‘ç«™æœåŠ¡å™¨æºç«™IP root.cn-bd-cdn CNAME pwecho.com.a.bdydns.com é»˜è®¤ BaiduCDN root.cn-bd-cdn MX mx1.qq.com é»˜è®¤ è…¾è®¯ä¼ä¸šé‚®ç®± root.cn-bd-cdn MX mx2.qq.com é»˜è®¤ è…¾è®¯ä¼ä¸šé‚®ç®± @ CNAME pwecho.com.cdn.cloudflare.com å¢ƒå¤– Cloudflare @ CNAME root.cn-bd-cdn.pwecho.com å¢ƒå†… é€šè¿‡ä»¥ä¸Šé…ç½®æŸ¥è¯¢DNSè®°å½•å³å¯å¾—å‡ºç»“æœ ä¸­å›½åœ°åŒº 123456789101112131415161718192021$ dig MX pwecho.com; &lt;&lt;&gt;&gt; DiG 9.14.8 &lt;&lt;&gt;&gt; MX pwecho.com;; global options: +cmd;; Got answer:;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 11135;; flags: qr rd ra; QUERY: 1, ANSWER: 3, AUTHORITY: 0, ADDITIONAL: 1;; OPT PSEUDOSECTION:; EDNS: version: 0, flags:; udp: 512;; QUESTION SECTION:;pwecho.com. IN MX;; ANSWER SECTION:pwecho.com. 597 IN CNAME root.cn-bd-cdn.pwecho.com.root.cn-bd-cdn.pwecho.com. 597 IN MX 5 mxbiz1.qq.com.root.cn-bd-cdn.pwecho.com. 597 IN MX 10 mxbiz2.qq.com.;; Query time: 10 msec;; SERVER: 192.168.50.1#53(192.168.50.1);; WHEN: Sat Feb 27 14:11:41 ;; MSG SIZE rcvd: 117 1234567891011121314151617$ dig CNAME pwecho.com; &lt;&lt;&gt;&gt; DiG 9.14.8 &lt;&lt;&gt;&gt; CNAME pwecho.com;; global options: +cmd;; Got answer:;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 63349;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 0;; QUESTION SECTION:;pwecho.com. IN CNAME;; ANSWER SECTION:pwecho.com. 563 IN CNAME root.cn-bd-cdn.pwecho.com.;; Query time: 76 msec;; SERVER: 192.168.50.1#53(192.168.50.1);; WHEN: Sat Feb 27 14:12:10 ;; MSG SIZE rcvd: 57 12345678910111213141516171819202122$ dig A pwecho.com; &lt;&lt;&gt;&gt; DiG 9.14.8 &lt;&lt;&gt;&gt; A pwecho.com;; global options: +cmd;; Got answer:;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 12359;; flags: qr rd ra; QUERY: 1, ANSWER: 4, AUTHORITY: 0, ADDITIONAL: 1;; OPT PSEUDOSECTION:; EDNS: version: 0, flags:; udp: 512;; QUESTION SECTION:;pwecho.com. IN A;; ANSWER SECTION:pwecho.com. 37 IN CNAME root.cn-bd-cdn.pwecho.com.root.cn-bd-cdn.pwecho.com. 37 IN CNAME pwecho.com.a.bdydns.com.pwecho.com.a.bdydns.com. 37 IN CNAME opencdncloud.jomodns.com.opencdncloud.jomodns.com. 37 IN A 101.72.249.35;; Query time: 9 msec;; SERVER: 192.168.50.1#53(192.168.50.1);; WHEN: Sat Feb 27 14:15:33 ;; MSG SIZE rcvd: 153 å¢ƒå¤–åœ°åŒº 123456789101112131415161718192021$ dig MX pwecho.com; &lt;&lt;&gt;&gt; DiG 9.16.1-Ubuntu &lt;&lt;&gt;&gt; MX pwecho.com;; global options: +cmd;; Got answer:;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 48915;; flags: qr rd ra; QUERY: 1, ANSWER: 2, AUTHORITY: 0, ADDITIONAL: 1;; OPT PSEUDOSECTION:; EDNS: version: 0, flags:; udp: 1232;; QUESTION SECTION:;pwecho.com. IN MX;; ANSWER SECTION:pwecho.com. 600 IN MX 10 mxbiz2.qq.com.pwecho.com. 600 IN MX 5 mxbiz1.qq.com.;; Query time: 276 msec;; SERVER: 1.1.1.1#53(1.1.1.1);; WHEN: Sat Feb 27 07:14:54 CET 2021;; MSG SIZE rcvd: 88 1234567891011121314151617181920$ dig CNAME pwecho.com; &lt;&lt;&gt;&gt; DiG 9.16.1-Ubuntu &lt;&lt;&gt;&gt; CNAME pwecho.com;; global options: +cmd;; Got answer:;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 55778;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1;; OPT PSEUDOSECTION:; EDNS: version: 0, flags:; udp: 1232;; QUESTION SECTION:;pwecho.com. IN CNAME;; ANSWER SECTION:pwecho.com. 600 IN CNAME pwecho.com.cdn.cloudflare.net.;; Query time: 276 msec;; SERVER: 1.1.1.1#53(1.1.1.1);; WHEN: Sat Feb 27 07:14:43 CET 2021;; MSG SIZE rcvd: 82 1234567891011121314151617181920212223$ dig A pwecho.com; &lt;&lt;&gt;&gt; DiG 9.16.1-Ubuntu &lt;&lt;&gt;&gt; A pwecho.com;; global options: +cmd;; Got answer:;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 35366;; flags: qr rd ra; QUERY: 1, ANSWER: 4, AUTHORITY: 0, ADDITIONAL: 1;; OPT PSEUDOSECTION:; EDNS: version: 0, flags:; udp: 1232;; QUESTION SECTION:;pwecho.com. IN A;; ANSWER SECTION:pwecho.com. 600 IN CNAME pwecho.com.cdn.cloudflare.net.pwecho.com.cdn.cloudflare.net. 300 IN A 104.26.6.173pwecho.com.cdn.cloudflare.net. 300 IN A 104.26.7.173pwecho.com.cdn.cloudflare.net. 300 IN A 172.67.69.29;; Query time: 280 msec;; SERVER: 1.1.1.1#53(1.1.1.1);; WHEN: Sat Feb 27 07:17:11 CET 2021;; MSG SIZE rcvd: 130 ä»ä¸Šé¢ç»“æœå¯ä»¥çœ‹å‡ºï¼Œpwecho.com.cdn.cloudflare.net æœ¬èº«è¿”å›çš„å°±æ˜¯ A è®°å½•ï¼Œè€Œå®ƒåšçš„åªæ˜¯å°†ä½ çš„ MX è®°å½•ä¹ŸåŠ åˆ°ä»–çš„ CNAME åŸŸåè§£æä¸­ï¼Œæ‰€ä»¥å®Œå…¨æ²¡æœ‰é—®é¢˜ï¼Œè€Œ DNSPOD è™½ç„¶è¿˜æ˜¯è¿”å› CNAME æ¥è§£æ A è®°å½•ï¼Œä½†æ˜¯å®æµ‹å¤šæ¬¡å¹¶æ²¡æœ‰å‘ç°å‡ºç°æŸ¥è¯¢ MX, CNAME æ··ä¹±è¿”å›çš„æƒ…å†µ, ä½†åŒæ ·æˆ‘ä¹Ÿå°šæœªèƒ½æä¾›èµ„æ–™è¯æ˜ä¸ä¼šå‡ºç°è¿™ä¸ªé—®é¢˜ã€‚ âš ï¸ è¡¥å……æµ‹è¯•ç»“æœ: é€šè¿‡ https://www.boce.com/dns/ æµ‹è¯•å‘ç°å…¨å›½æŸ¥è¯¢çš„æ—¶å€™ä¼šæœ‰éƒ¨åˆ†åœ°åŒºéšæœºè¿”å› CNAME è®°å½•ï¼Œæ‰€ä»¥è¿™ä¸ªæ–¹æ³•è¿˜æ˜¯ä¸ç¨³å®šï¼ŒCloudflare é‚£ç§å®ç°å¯¹å¢ƒå¤–é‚®ç®±æ¥è¯´åˆ™å®Œå…¨æ²¡æœ‰é—®é¢˜ å…¶å®è¿™é‡Œè¿˜æœ‰ä¸ªå‘ç°ï¼Œå³ä¾¿æ˜¯å›½å†…çš„ QQé‚®ç®±, è…¾è®¯ä¼ä¸šé‚®ç®±, 163é‚®ç®± æˆ–è€…æ˜¯å›½å¤–çš„ Gmail, Outlook éƒ½ä¼šæŸ¥è¯¢å‡ºå¢ƒå¤–çš„MXè®°å½•ï¼Œå³ä¾¿å¢ƒå†…æ²¡è®¾ç½®MXè®°å½•ä¹Ÿå¯ï¼Œæ‰€ä»¥å¦‚æœä¸æ”¾å¿ƒå…¶å®å¯ä»¥ç›´æ¥å¹²æ‰å¢ƒå†…çš„MXè®°å½•ï¼Œåªè®© Cloudflare è¿”å› MX è®°å½•ä¹Ÿå¯ä»¥ç¨³å®šè¿ä½œ (ä¸æ‰“åŒ…ç¥¨ï¼Œå¢ƒå†…è¿˜æœ‰å¾ˆå¤šé‚®ç®±æ²¡æœ‰åšæµ‹è¯• å‚è€ƒèµ„æ–™ åŸŸåè§£æçš„ MX å’Œ CNAME è®°å½•å†²çª - è°¢å…ˆæ–Œçš„åšå®¢ è§£æè®°å½•å†²çªè§„åˆ™ - é˜¿é‡Œäº‘æ–‡æ¡£ ä¸‰ç§æ–¹æ³•è§£å†³åŸŸåè§£æçš„ä¸»æœºè®°å½•å†²çª - Erdongâ€™ Blog åŸŸå MX è®°å½•ä¸ CNAME å†²çª - è€é¬¼çš„åšå®¢ RCF 1034 - ä¸‹è½½PDFæ–‡ä»¶ DNS using CNAMEs breaks MX records? - StackExchange","categories":[{"name":"dns","slug":"dns","permalink":"https://blog.mitt.fun/categories/dns/"}],"tags":[{"name":"DNS","slug":"DNS","permalink":"https://blog.mitt.fun/tags/DNS/"},{"name":"åŸŸåé‚®ç®±","slug":"åŸŸåé‚®ç®±","permalink":"https://blog.mitt.fun/tags/%E5%9F%9F%E5%90%8D%E9%82%AE%E7%AE%B1/"},{"name":"ä¼ä¸šé‚®ç®±","slug":"ä¼ä¸šé‚®ç®±","permalink":"https://blog.mitt.fun/tags/%E4%BC%81%E4%B8%9A%E9%82%AE%E7%AE%B1/"},{"name":"GEODNS","slug":"GEODNS","permalink":"https://blog.mitt.fun/tags/GEODNS/"},{"name":"åŒºåŸŸè§£æ","slug":"åŒºåŸŸè§£æ","permalink":"https://blog.mitt.fun/tags/%E5%8C%BA%E5%9F%9F%E8%A7%A3%E6%9E%90/"},{"name":"MXå…±å­˜","slug":"MXå…±å­˜","permalink":"https://blog.mitt.fun/tags/MX%E5%85%B1%E5%AD%98/"},{"name":"MX","slug":"MX","permalink":"https://blog.mitt.fun/tags/MX/"},{"name":"CNAME","slug":"CNAME","permalink":"https://blog.mitt.fun/tags/CNAME/"},{"name":"Cloudflare","slug":"Cloudflare","permalink":"https://blog.mitt.fun/tags/Cloudflare/"},{"name":"Dnspod","slug":"Dnspod","permalink":"https://blog.mitt.fun/tags/Dnspod/"},{"name":"ç™¾åº¦CDN","slug":"ç™¾åº¦CDN","permalink":"https://blog.mitt.fun/tags/%E7%99%BE%E5%BA%A6CDN/"}]},{"title":"å…³äºã€ŠKubernetes æ··åˆäº‘ç”¨Kiloè§£å†³NATèŠ‚ç‚¹é€šè®¯çš„é—®é¢˜ã€‹çš„é‚£ä»¶äº‹","slug":"kubernetes/k8s-æ··åˆäº‘ç»„ç½‘","date":"2021-02-25T05:07:29.000Z","updated":"2021-02-25T05:07:29.000Z","comments":true,"path":"service/kubernetes/2021/kubernetes/k8s-æ··åˆäº‘ç»„ç½‘/","link":"","permalink":"https://blog.mitt.fun/service/kubernetes/2021/kubernetes/k8s-%E6%B7%B7%E5%90%88%E4%BA%91%E7%BB%84%E7%BD%91/","excerpt":"pre-post()æœ€è¿‘æœ‰åœ¨å­¦ä¹ K8Sç›¸å…³ï¼ŒåŒæ—¶ä¹Ÿå°†è‡ªå·±çš„æ‰€æœ‰æœåŠ¡å…¨éƒ¨éƒ½è¿ç§»åˆ°äº†K8Sé›†ç¾¤ä¸Šï¼Œæ„Ÿå—åˆ°K8Så¼ºå¤§çš„åŒæ—¶ä¹Ÿèƒ½æ˜æ˜¾æ„Ÿå—åˆ°å¯¹äºæˆ‘è¿™ç§ä¸€èˆ¬ç”¨æˆ·ç¯å¢ƒçš„éƒ¨ç½²ä¸æ˜¯å¾ˆå‹å¥½ï¼Œä¾‹å¦‚å»ºè®®çš„é«˜å¯ç”¨é›†ç¾¤è‡³å°‘è¦æœ‰ ä¸‰å° Master, ä¸‰å° Worker, å¯¹æˆ‘è¿™ç§ ç©·é€¼ æ™®é€šç©å®¶æ¥è¯´æ˜¯å¾ˆé«˜æ˜‚çš„ï¼Œä½†ç»è¿‡å‡ æ¬¡å®è·µæŠŠç”Ÿäº§ç¯å¢ƒæç‚¸å‡ æ¬¡åè§‰å¾—è¿™æ˜¯æœ‰å¿…è¦çš„(å“­)ï¼Œä½†æˆ‘çš„æƒ³æ³•æ˜¯ç”¨K8Sä½œä¸ºæˆ‘ä¸»è¦éƒ¨ç½²æ–¹å¼ï¼Œæ‰€ä»¥è¿˜æ˜¯éå¸¸é«˜æ˜‚çš„ï¼Œåƒæˆ‘è¿™ç§ä¸ºäº†èƒ½å¤Ÿç®¡ç†æ‰€æœ‰èŠ‚ç‚¹ä½†æ˜¯åˆä¸ä¼šé‡åº¦ä½¿ç”¨K8Sçš„ï¼Œè¿™é‡Œæ¨è K3S æ¥ä»£æ›¿K8Sä½œä¸ºè¦æ±‚ä¸é«˜çš„ç”Ÿäº§ç¯å¢ƒï¼Œä¸è¿‡è¿™ç¯‡æ–‡ç« è¿˜æ˜¯ç”¨å®Œæ•´çš„K8Sæ¥åšï¼Œä½†ç†è®ºä¸Š K3S æ˜¯å®Œå…¨é€šç”¨çš„ã€‚","text":"pre-post()æœ€è¿‘æœ‰åœ¨å­¦ä¹ K8Sç›¸å…³ï¼ŒåŒæ—¶ä¹Ÿå°†è‡ªå·±çš„æ‰€æœ‰æœåŠ¡å…¨éƒ¨éƒ½è¿ç§»åˆ°äº†K8Sé›†ç¾¤ä¸Šï¼Œæ„Ÿå—åˆ°K8Så¼ºå¤§çš„åŒæ—¶ä¹Ÿèƒ½æ˜æ˜¾æ„Ÿå—åˆ°å¯¹äºæˆ‘è¿™ç§ä¸€èˆ¬ç”¨æˆ·ç¯å¢ƒçš„éƒ¨ç½²ä¸æ˜¯å¾ˆå‹å¥½ï¼Œä¾‹å¦‚å»ºè®®çš„é«˜å¯ç”¨é›†ç¾¤è‡³å°‘è¦æœ‰ ä¸‰å° Master, ä¸‰å° Worker, å¯¹æˆ‘è¿™ç§ ç©·é€¼ æ™®é€šç©å®¶æ¥è¯´æ˜¯å¾ˆé«˜æ˜‚çš„ï¼Œä½†ç»è¿‡å‡ æ¬¡å®è·µæŠŠç”Ÿäº§ç¯å¢ƒæç‚¸å‡ æ¬¡åè§‰å¾—è¿™æ˜¯æœ‰å¿…è¦çš„(å“­)ï¼Œä½†æˆ‘çš„æƒ³æ³•æ˜¯ç”¨K8Sä½œä¸ºæˆ‘ä¸»è¦éƒ¨ç½²æ–¹å¼ï¼Œæ‰€ä»¥è¿˜æ˜¯éå¸¸é«˜æ˜‚çš„ï¼Œåƒæˆ‘è¿™ç§ä¸ºäº†èƒ½å¤Ÿç®¡ç†æ‰€æœ‰èŠ‚ç‚¹ä½†æ˜¯åˆä¸ä¼šé‡åº¦ä½¿ç”¨K8Sçš„ï¼Œè¿™é‡Œæ¨è K3S æ¥ä»£æ›¿K8Sä½œä¸ºè¦æ±‚ä¸é«˜çš„ç”Ÿäº§ç¯å¢ƒï¼Œä¸è¿‡è¿™ç¯‡æ–‡ç« è¿˜æ˜¯ç”¨å®Œæ•´çš„K8Sæ¥åšï¼Œä½†ç†è®ºä¸Š K3S æ˜¯å®Œå…¨é€šç”¨çš„ã€‚ subject(â€˜å®ç°ç›®æ ‡â€™)åˆ©ç”¨ Kilo å°†å¸¦æœ‰å…¬ç½‘IPçš„NATäº‘æœåŠ¡å™¨ç»„æˆK8Sé›†ç¾¤ï¼Œæ”¯æŒ P2P, DDNS (è¦æ±‚æœ‰å…¬ç½‘IPä¸”éœ€è¦ç«¯å£æ˜ å°„) subject(â€˜Kiloä»‹ç»â€™)Kilo æ˜¯ä¸€ä¸ªé€šè¿‡ Wireguard ç”¨äºå»ºç«‹æ··åˆäº‘ç½‘ç»œçš„å·¥å…· subject(â€˜ç°æœ‰é—®é¢˜â€™)æˆ‘çš„æœåŠ¡å™¨æ„æˆæ˜¯è¿™æ ·çš„(ä»¥ä¸‹IPçš†ä¸ºè™šæ‹Ÿ): Name ifc-IP Location Role Nat k8s-master 123.123.123.123 Hetzner Master NO cn-sh01-node 10.0.0.4 QCloud Worker YES cn-hz01-node 192.168.1.120 Home Worker YES å¯ä»¥çœ‹åˆ°æˆ‘çš„ä¸‰å°æœåŠ¡å™¨éƒ½ä¸æ˜¯åŒä¸€ä¸ªç½‘æ®µç”šè‡³éƒ½ä¸æ˜¯åŒä¸€ä¸ªæœåŠ¡å•†çš„ã€‚æ‰€ä»¥ä¼šæœ‰å‡ ä¸ªé—®é¢˜ kube-proxy æ— æ³•æ­£å¸¸å·¥ä½œè½¬å‘æµé‡ metrics é‡‡é›†æ— æ³•å·¥ä½œ logs/shell æ— æ³•å·¥ä½œ subject(â€˜è§£å†³é—®é¢˜â€™)ä¹‹å‰æ˜¯ç”¨ Weave æ¥ä½œä¸ºCNIçš„ï¼Œç„¶åä¸ºäº†è§£å†³ kube-proxy çš„ä¸€äº›é—®é¢˜æ¢æˆäº† Flannel, ç½‘ä¸ŠæŸ¥æ‰¾ä¸€äº›èµ„æ–™å’Œissuesä»¥åå‘ç°å¦‚æœè¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå°±å¾—å…ˆå°†æ‰€æœ‰èŠ‚ç‚¹è¿èµ·æ¥ï¼Œè¿èµ·æ¥çš„æ–¹æ³•å°±æ˜¯VPNï¼Œç„¶åè®©é€šè®¯æµé‡èµ°VPNæ¥å£å³å¯è§£å†³ï¼Œä½†æ˜¯æŒ‰å¸¸è§„ç†è§£VPNæµé‡æ˜¯éœ€è¦ä¸­å¿ƒæœåŠ¡å™¨è½¬å‘æµé‡çš„ï¼Œé‚£å°±ä¼šå¯¼è‡´æ‰€æœ‰æµé‡è½¬å‘åˆ°åŒä¸€å°æœåŠ¡å™¨ï¼Œå‹åŠ›å’Œå»¶è¿Ÿä¹Ÿä¼šéå¸¸å¤§ä¸ç¬¦åˆéœ€æ±‚ï¼Œç„¶åæˆ‘å»æœäº†P2P VPNå‘ç° Wireguard æ˜¯æ”¯æŒPeer2Peerçš„ï¼Œé¡ºåŠ¿åœ¨æŸä¸ªissueé‡Œçœ‹åˆ°æœ‰äººæåˆ°ç”¨ Kilo è¿›è¡Œè‡ªåŠ¨ç»„ç½‘ï¼Œå¹¶ä¸” Kilo æ˜¯æ”¯æŒåœ¨ Flannel ä¹‹ä¸Šè¿è¡Œçš„ ç«¯å£é€šè®¯æ£€æŸ¥æˆ‘æ˜¯é‡‡ç”¨ Flannel+Calico+Kilo çš„æ–¹å¼è®¾ç½®ç½‘ç»œçš„ï¼Œæ‰€ä»¥éœ€è¦ä»¥ä¸‹ç«¯å£æ”¾é€š Port Range Protocol Remark 8285 UDP Flannel 8472 UDP Flannel 51820 UDP Wireguard é»˜è®¤ç«¯å£ 10250 TCP Kubelet API 30000-32767 TCP+UDP NodePort æœåŠ¡ç«¯å£ å®‰è£… KiloKubeadm 1$ kubectl apply -f https://raw.githubusercontent.com/squat/kilo/master/manifests/kilo-kubeadm-flannel.yaml å¦‚æœè¦å¸è½½ï¼Œç›´æ¥ kubectl delete å°±å¥½äº† é…ç½®å¤–éƒ¨è¿æ¥IPç”±äºç›®å‰å°šæœªæ”¯æŒ NAT to NAT(ç†è®ºå¯ä»¥å®ç°)ï¼Œæ‰€ä»¥æ¯ä¸ªNodeéƒ½å¿…é¡»å…·å¤‡å¤–éƒ¨(å…¬ç½‘)è®¿é—®æ¡ä»¶ï¼Œä½†æ˜¯ä½ ä¼šå‘ç°ä¸€ä»¶äº‹ï¼Œæ¯ä¸ªNodeéƒ½åªä¼šæ‹¿åˆ°ç½‘å¡çš„IPï¼Œå®ƒæ²¡åŠæ³•å‘ç°ä½ çš„å¤–éƒ¨IP æ‰€ä»¥å°±åƒ Flannel é€šè¿‡ flannel.alpha.coreos.com/public-ip-overwrite æ¥è¦†å†™å¤–éƒ¨é€šè®¯IPä¸€æ · Kilo åŒæ ·ä¹Ÿæä¾›äº† kilo.squat.ai/force-endpoint æ¥æŒ‡å®šå¤–éƒ¨é€šè®¯è¿æ¥ç‚¹ï¼Œæ ¼å¼æ˜¯ &quot;IP:PORT&quot; æˆ–è€… &quot;[DOMAIN]:PORT&quot;ï¼Œæ˜¯çš„ï¼Œå®ƒæ”¯æŒåŸŸåï¼Œæ‰€ä»¥å°±å¯ä»¥å®ç°æˆ‘ä»¬ HOME workerçš„DDNSéœ€æ±‚ï¼Œåªè¦é˜²ç«å¢™æ”¾é€šç«¯å£æˆ–è€…è·¯ç”±å™¨è½¬å‘ç«¯å£å°±å¯ä»¥è‡ªç”±é€šè®¯äº† ç¼–è¾‘ cn-hz01-node èŠ‚ç‚¹ï¼Œåœ¨ metadata.annotations é‡ŒåŠ å…¥ kilo.squat.ai/force-endpoint: &#39;[home.mydomain.com]:51820&#39;ï¼Œç„¶åè¿‡ä¸€ä¼šé€šè¿‡ kubectl desc node cn-hz01-node å°±å¯ä»¥çœ‹åˆ°å®ƒè‡ªåŠ¨è§£æäº†åŸŸåå¹¶ä¸”æ·»åŠ äº†ä¸€ä¸ªæ–°çš„ kilo.squat.ai/endpoint annotationï¼Œå€¼ä¸ºä½ åŸŸåæŒ‡å‘çš„IP åŒæ ·æ­¤æ–¹æ³•å»æ›´æ”¹ cn-sh01-node çš„ annotationsï¼Œè¿‡ä¸€ä¼šå°±å¯ä»¥çœ‹åˆ° metrics ä¿¡æ¯å·²ç»æ­£å¸¸æ˜¾ç¤ºäº†(å‰ææ˜¯ä½ å·²ç»éƒ¨ç½²äº†metricsé‡‡é›†) å»ºè®®é‡‡ç”¨ Flannel çš„ vxlan ä½œä¸ºåç«¯ï¼Œä¸é‡‡ç”¨ IPSec ç­‰åŠ å¯†åç«¯é¿å…ä¸å¿…è¦çš„äºŒæ¬¡å¼€é”€ å…³äºN2Nå®ç° ç›®å‰ Kilo çš„N2Nå®ç°è¿˜åœ¨è®¨è®ºå¹¶ä¸”å·²ç»åœ¨è®¡åˆ’é€‚é…ï¼Œå…·ä½“å¯ä»¥åœ¨è¿™é‡Œçœ‹åˆ° https://github.com/squat/kilo/issues/109 subject(â€˜ä¸é€šè¿‡VPNå¤–éƒ¨ç›´è¿çš„å¯èƒ½æ€§â€™)è¯´ä¸ªé¢˜å¤–è¯ï¼Œå‡å¦‚å…¨éƒ¨NODEéƒ½æ˜¯æœ‰å…¬ç½‘IPä½†æ˜¯ä¼šæœ‰ä¸€å±‚NATçš„èƒ½ä¸èƒ½æ­£å¸¸é€šè®¯å‘¢ï¼Œè¿™ä¸ªè¯»è¿‡ä¸€ç‚¹Kubernetesçš„ä»£ç ï¼Œè¿™ä¸ªæ˜¯æœ‰å¯èƒ½çš„ï¼Œå°±æ˜¯æ›´æ”¹Nodeçš„ status.addresses æ·»åŠ ä¸€ä¸ª Type ä¸º ExternalIP çš„IPåœ°å€ï¼Œä½†æ˜¯è¿™é‡Œæœ‰ä¸ªé—®é¢˜å°±æ˜¯ï¼Œä½ æ²¡åŠæ³•ç›´æ¥ç¼–è¾‘æˆ–è€…patchä¸€ä¸ªnodeçš„statuså€¼ï¼Œé‚£ä¹ˆè¿™ä¸ªaddressesæ˜¯æ€ä¹ˆæ¥çš„å‘¢ï¼Ÿ addresses å®é™…ä¸Šæ˜¯é€šè¿‡ cloud-provider è®¾ç½®çš„ï¼Œä»–è¯»å–ä½ çš„ç½‘å¡å¹¶å°†å…¶IPè®¾ç½®ä¸º InternalIP çš„address, å¦‚æœä½ æ˜¯GCE, Azureç­‰ï¼Œä»–ä»¬ä¼šå»è·Ÿå¹³å°é€šè®¯è·å–ä½ æœºå™¨çš„å¤–ç½‘ç»‘å®šç½‘å¡ä¿¡æ¯ï¼Œå¹¶ä¸”è®¾ç½®ä¸º ExternalIPï¼Œè€Œ metrics-server çš„é»˜è®¤å¯åŠ¨å‚æ•° --kubelet-preferred-address-types=ExternalIP,InternalIP,Hostname å®šä¹‰äº†å®ƒä¼šå°è¯•å»å’Œå¤–éƒ¨IPã€å†…éƒ¨IPã€ä¸»æœºåè¿›è¡Œé€šè®¯ï¼Œæ‰€ä»¥å¦‚æœä½ æ˜¯é€šè¿‡äº‘æœåŠ¡å•†çš„k8sæ‰˜ç®¡ï¼Œé‚£ä¹ˆå®ƒå°±ä¼šè‡ªåŠ¨è®¾ç½®å¤–éƒ¨IPï¼Œä½†æ˜¯æ‰‹å·¥è®¾ç½®æ˜¯è¡Œä¸é€šçš„ï¼Œæ‰€ä»¥å¦‚æœè‡ªå·±å†™ä¸€ä¸ª â€œFakeâ€ cloud-provider çš„è¯ä¹Ÿè®¸ä¹Ÿè¡Œå¾—é€šï¼Œä½†å…¶å®ä»·å€¼å°±å¾ˆä½äº†ï¼Œä¸å¦‚ç›´æ¥VPNç»„ç½‘æ¥çš„å®åœ¨ã€‚","categories":[{"name":"service","slug":"service","permalink":"https://blog.mitt.fun/categories/service/"},{"name":"kubernetes","slug":"service/kubernetes","permalink":"https://blog.mitt.fun/categories/service/kubernetes/"}],"tags":[{"name":"Kubernetes","slug":"Kubernetes","permalink":"https://blog.mitt.fun/tags/Kubernetes/"},{"name":"K8S","slug":"K8S","permalink":"https://blog.mitt.fun/tags/K8S/"},{"name":"K3S","slug":"K3S","permalink":"https://blog.mitt.fun/tags/K3S/"},{"name":"Wireguard","slug":"Wireguard","permalink":"https://blog.mitt.fun/tags/Wireguard/"},{"name":"Kilo","slug":"Kilo","permalink":"https://blog.mitt.fun/tags/Kilo/"},{"name":"Peer2Peer","slug":"Peer2Peer","permalink":"https://blog.mitt.fun/tags/Peer2Peer/"}]},{"title":"Docker - ç»™æ¯ä¸ªå®¹å™¨é…ç½®å…¬ç½‘IP","slug":"docker/Docker-ç»™æ¯ä¸ªå®¹å™¨é…ç½®å…¬ç½‘IP","date":"2018-05-01T12:28:08.000Z","updated":"2021-02-25T11:57:00.000Z","comments":true,"path":"service/2018/docker/Docker-ç»™æ¯ä¸ªå®¹å™¨é…ç½®å…¬ç½‘IP/","link":"","permalink":"https://blog.mitt.fun/service/2018/docker/Docker-%E7%BB%99%E6%AF%8F%E4%B8%AA%E5%AE%B9%E5%99%A8%E9%85%8D%E7%BD%AE%E5%85%AC%E7%BD%91IP/","excerpt":"pre-post()ä¸ºäº†æ–¹ä¾¿éƒ¨ç½²æµé‡è½¬å‘æœåŠ¡ï¼Œé‡‡ç”¨äº†Dockeræ¥å¹²è¿™ä¸ªäº‹ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ä¸€å°èŠ‚ç‚¹åªæœ‰ä¸€ä¸ªIPï¼Œä½¿ç”¨ç«¯å£æ˜ å°„æˆ–è€…ç”¨å‚æ•° --network host ç›´æ¥ä½¿ç”¨ä¸»æœºçš„ç½‘ç»œæ¥ç›‘å¬å’Œè½¬å‘æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œä½†æ˜¯æœ‰ä¸€äº›èŠ‚ç‚¹ä¼šå­˜åœ¨å¤šä¸ªæˆ–ä¸€ä¸ªæ®µçš„å¤–éƒ¨IPï¼Œè¿™æ—¶å€™è™½ç„¶ IN æ–¹å‘æ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯ OUT æ–¹å‘åªä¼šé‡‡ç”¨ä¸»æœºè®¾ç½®çš„é»˜è®¤è·¯ç”±æ¥è®¿é—®ï¼Œå°±å¯¼è‡´äº†è½¬å‘çš„æµé‡éƒ½ä½¿ç”¨åŒä¸€ä¸ªIPè½¬å‘å‡ºå»äº†ï¼Œè¿™æ˜¯ä¸å¯¹çš„ï¼Œæ‰€ä»¥æ¥ä¸‹æ¥å°±ç ”ç©¶å¦‚ä½•æ‰èƒ½è‡ªå®šä¹‰å‡ºå£æµé‡ï¼Œè¿™ç¯‡æ–‡ç« åˆ™é‡‡ç”¨ç»™å®¹å™¨é…ç½®å¤–éƒ¨IPçš„æ–¹å¼å®ç°ã€‚ æ­¤æ–¹æ³•é€‚åˆéNATä¸»æœº","text":"pre-post()ä¸ºäº†æ–¹ä¾¿éƒ¨ç½²æµé‡è½¬å‘æœåŠ¡ï¼Œé‡‡ç”¨äº†Dockeræ¥å¹²è¿™ä¸ªäº‹ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ä¸€å°èŠ‚ç‚¹åªæœ‰ä¸€ä¸ªIPï¼Œä½¿ç”¨ç«¯å£æ˜ å°„æˆ–è€…ç”¨å‚æ•° --network host ç›´æ¥ä½¿ç”¨ä¸»æœºçš„ç½‘ç»œæ¥ç›‘å¬å’Œè½¬å‘æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œä½†æ˜¯æœ‰ä¸€äº›èŠ‚ç‚¹ä¼šå­˜åœ¨å¤šä¸ªæˆ–ä¸€ä¸ªæ®µçš„å¤–éƒ¨IPï¼Œè¿™æ—¶å€™è™½ç„¶ IN æ–¹å‘æ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯ OUT æ–¹å‘åªä¼šé‡‡ç”¨ä¸»æœºè®¾ç½®çš„é»˜è®¤è·¯ç”±æ¥è®¿é—®ï¼Œå°±å¯¼è‡´äº†è½¬å‘çš„æµé‡éƒ½ä½¿ç”¨åŒä¸€ä¸ªIPè½¬å‘å‡ºå»äº†ï¼Œè¿™æ˜¯ä¸å¯¹çš„ï¼Œæ‰€ä»¥æ¥ä¸‹æ¥å°±ç ”ç©¶å¦‚ä½•æ‰èƒ½è‡ªå®šä¹‰å‡ºå£æµé‡ï¼Œè¿™ç¯‡æ–‡ç« åˆ™é‡‡ç”¨ç»™å®¹å™¨é…ç½®å¤–éƒ¨IPçš„æ–¹å¼å®ç°ã€‚ æ­¤æ–¹æ³•é€‚åˆéNATä¸»æœº subject(â€˜å®ç°ç›®æ ‡â€™)ç»™æ¯ä¸ª Docker å®¹å™¨éƒ½é…ç½®ä¸åŒçš„å…¬ç½‘IPå‡ºå£ solution(â€˜é™„åŠ ç½‘ç»œåˆ°å®¹å™¨â€™)12345678# ä» eth1 æ¥å£åˆ é™¤IP$ sudo ip addr del 192.168.33.10/24 dev eth1# åˆ›å»ºä¸€ä¸ªæ¡¥æ¥åç§°ä¸º â€œdocker1â€ çš„ shared_nw ç½‘ç»œ$ sudo docker network create --driver bridge --subnet=192.168.33.0/24 --gateway=192.168.33.10 --opt &quot;com.docker.network.bridge.name&quot;=&quot;docker1&quot; shared_nw# æ·»åŠ  â€œdocker1â€ åˆ° eth1$ sudo brctl addif docker1 eth1 å…¶ä¸­ 192.168.33.0/24 æ˜¯å­ç½‘æ®µ, 192.168.33.10 æ˜¯IPåœ°å€ 123# é€šè¿‡ curl å®¹å™¨æ¥éªŒè¯IPç»“æœ$ docker run -it curlimages/curl --net shared_nw --ip 192.168.33.11 ip.sb# è¾“å‡ºç»“æœ: 192.168.33.11 è¿™æ ·è¿™ä¸ªå®¹å™¨æœ¬èº«çš„IPå°±å˜æˆäº†å¤–éƒ¨IP å¼Šç«¯é‡‡ç”¨è¿™ç§æ–¹æ³•ä¼šæŠŠä¸»æœºçš„IPå‰¥ç¦»ï¼Œå¦‚æœä½ æ²¡æœ‰å…¶ä»–æ¥å…¥ç½‘å¡çš„è¯ä¼šå¯¼è‡´æ–­ç½‘æ— æ³•å¤–éƒ¨è¿›å…¥ï¼Œåªèƒ½é€šè¿‡ Console æ¥è°ƒæ•´ å‚è€ƒæ¥æº https://forums.docker.com/t/public-accessible-ip-in-container-like-bridge-network-in-virtualbox/3668/6 https://qiita.com/kjtanaka/items/f16757c1f0cc86ff225b solution(â€˜æ¡¥æ¥ç½‘ç»œIPâ€™)12# åˆ›å»ºåä¸º &quot;pnet01&quot; çš„ macvlan ç½‘ç»œ$ docker network create -d macvlan --subnet 23.89.4.0/24 --gateway 23.89.4.1 -o parent=ens3 --aux-address=&quot;master=23.89.4.205&quot; pnet01 å…¶ä¸­ 23.89.4.0/24 æ˜¯å­ç½‘æ®µ, 23.89.4.1 æ˜¯ç½‘å…³åœ°å€, ens3 æ˜¯ç½‘å¡æ¥å£åç§°, 23.89.4.205 æ˜¯å¤–éƒ¨IP 123# é€šè¿‡ curl å®¹å™¨æ¥éªŒè¯IPç»“æœ$ docker run -it curlimages/curl --net pnet01 --ip 23.89.4.207 ip.sb# è¾“å‡ºç»“æœ: 23.89.4.207 å…¶ä¸­ 23.89.4.207 æ˜¯è¦åˆ†é…ç»™å®¹å™¨çš„åŒç½‘æ®µçš„IP å…¶ä»–ä¿¡æ¯ä¸»æœº 123456789101112131415# ifconfigens3: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt; mtu 1500 inet 23.89.4.205 netmask 255.255.255.0 broadcast 23.89.4.255 inet6 fe80::216:3cff:fe7e:fbeb prefixlen 64 scopeid 0x20&lt;link&gt; ether 00:16:3c:7e:fb:eb txqueuelen 1000 (Ethernet) RX packets 96281 bytes 7457992 (7.1 MiB) RX errors 0 dropped 0 overruns 0 frame 0 TX packets 5325 bytes 1603561 (1.5 MiB) TX errors 0 dropped 0 overruns 0 carrier 0 collisions 0# routeDestination Gateway Genmask Flags Metric Ref Use Ifacedefault 1.4-89-23.rdns. 0.0.0.0 UG 0 0 0 ens3localnet 0.0.0.0 255.255.255.0 U 0 0 0 ens3172.17.0.0 0.0.0.0 255.255.0.0 U 0 0 0 docker0 å®¹å™¨å†… 12345678910111213# ifconfigeth0 Link encap:Ethernet HWaddr 02:42:17:59:04:CF inet addr:23.89.4.207 Bcast:0.0.0.0 Mask:255.255.255.0 UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1 RX packets:27457 errors:0 dropped:0 overruns:0 frame:0 TX packets:579 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:0 RX bytes:1839527 (1.7 MiB) TX bytes:81473 (79.5 KiB)# routeDestination Gateway Genmask Flags Metric Ref Use Ifacedefault 1.4-89-23.rdns. 0.0.0.0 UG 0 0 0 eth023.89.4.0 * 255.255.255.0 U 0 0 0 eth0 å¼Šç«¯ä»…é€‚ç”¨äºæ‹¥æœ‰ä¸€ä¸ªæ®µçš„IPçš„æœåŠ¡å™¨ï¼Œé‡‡ç”¨è¿™ç§æ–¹å¼çš„ä¸»æœºä¼šä¿ç•™ä¸€ä¸ªIPç”¨äºé€šè®¯å’Œæ¡¥æ¥ï¼Œç„¶ååˆ†é…åŒç½‘æ®µçš„å…¶ä»–IPç»™å®¹å™¨ï¼Œå¦‚æœæœ‰ä¸åŒç½‘æ®µå’Œç½‘å…³çš„IPï¼Œå°±éœ€è¦åŒæ ·åˆ›å»ºç¬¬äºŒä¸ªç½‘ç»œ å‚è€ƒæ¥æº https://docs.docker.com/network/network-tutorial-macvlan/#bridge-example https://www.aquasec.com/wiki/display/containers/Docker+Networking+101 subject(â€˜Endâ€™)è¿™ç¯‡æ–‡ç« å†…å®¹æ˜¯ 2018 å¹´å†™çš„ï¼Œä¸€ç›´å’•å’•åˆ° 2021 å¹´æ‰è¡¥ä¸Šï¼Œå¯¹ç°åœ¨çš„æˆ‘æ¥è¯´å¯¹å®¹å™¨ä»¥åŠç½‘ç»œæ–¹é¢æœ‰äº†æ–°çš„ç†è§£ï¼Œæ‰€ä»¥è¿™ç¯‡æ–‡ç« å†…å®¹å…¶å®ä¹Ÿç®—æ˜¯æœ‰ç‚¹ è¿‡æ—¶ äº†ï¼Œè¿˜æœ‰ä¸€ä¸ªæ–¹æ³•æ˜¯é‡‡ç”¨ iptables NATè¿›è¡Œå®ç°ï¼Œä½†æ˜¯äººå·¥ç»´æŠ¤æ˜¾ç„¶æœ‰äº›ç¹çï¼Œè™½ç„¶æˆ‘æ²¡æœ‰å†è¿™ä¸ªæ–¹å‘ç»§ç»­ç ”ç©¶äº†ï¼Œä½†æ˜¯å¸Œæœ›èƒ½ç»™æœ‰éœ€è¦çš„äººä¸€ä¸ªå‚è€ƒã€‚","categories":[{"name":"service","slug":"service","permalink":"https://blog.mitt.fun/categories/service/"}],"tags":[{"name":"Docker","slug":"Docker","permalink":"https://blog.mitt.fun/tags/Docker/"}]},{"title":"Hello World","slug":"hello-world","date":"2018-01-28T17:30:37.000Z","updated":"2021-02-25T03:57:00.000Z","comments":true,"path":"misc/2018/hello-world/","link":"","permalink":"https://blog.mitt.fun/misc/2018/hello-world/","excerpt":"","text":"Hello Everyone, Iâ€™m Mitt, and I wish you all Have fun every day!","categories":[],"tags":[{"name":"Milestone","slug":"Milestone","permalink":"https://blog.mitt.fun/tags/Milestone/"}]}],"categories":[{"name":"blockchains","slug":"blockchains","permalink":"https://blog.mitt.fun/categories/blockchains/"},{"name":"service","slug":"service","permalink":"https://blog.mitt.fun/categories/service/"},{"name":"kubernetes","slug":"service/kubernetes","permalink":"https://blog.mitt.fun/categories/service/kubernetes/"},{"name":"scripts","slug":"scripts","permalink":"https://blog.mitt.fun/categories/scripts/"},{"name":"dns","slug":"dns","permalink":"https://blog.mitt.fun/categories/dns/"}],"tags":[{"name":"BlockChains","slug":"BlockChains","permalink":"https://blog.mitt.fun/tags/BlockChains/"},{"name":"Polkadot","slug":"Polkadot","permalink":"https://blog.mitt.fun/tags/Polkadot/"},{"name":"Governance","slug":"Governance","permalink":"https://blog.mitt.fun/tags/Governance/"},{"name":"Darwinia","slug":"Darwinia","permalink":"https://blog.mitt.fun/tags/Darwinia/"},{"name":"Crab","slug":"Crab","permalink":"https://blog.mitt.fun/tags/Crab/"},{"name":"Substrate","slug":"Substrate","permalink":"https://blog.mitt.fun/tags/Substrate/"},{"name":"Notebook","slug":"Notebook","permalink":"https://blog.mitt.fun/tags/Notebook/"},{"name":"Kubernetes","slug":"Kubernetes","permalink":"https://blog.mitt.fun/tags/Kubernetes/"},{"name":"K8S","slug":"K8S","permalink":"https://blog.mitt.fun/tags/K8S/"},{"name":"K3S","slug":"K3S","permalink":"https://blog.mitt.fun/tags/K3S/"},{"name":"Velero","slug":"Velero","permalink":"https://blog.mitt.fun/tags/Velero/"},{"name":"Issues","slug":"Issues","permalink":"https://blog.mitt.fun/tags/Issues/"},{"name":"Flannel","slug":"Flannel","permalink":"https://blog.mitt.fun/tags/Flannel/"},{"name":"Cloudflare","slug":"Cloudflare","permalink":"https://blog.mitt.fun/tags/Cloudflare/"},{"name":"Scripts","slug":"Scripts","permalink":"https://blog.mitt.fun/tags/Scripts/"},{"name":"Friends","slug":"Friends","permalink":"https://blog.mitt.fun/tags/Friends/"},{"name":"DNS","slug":"DNS","permalink":"https://blog.mitt.fun/tags/DNS/"},{"name":"åŸŸåé‚®ç®±","slug":"åŸŸåé‚®ç®±","permalink":"https://blog.mitt.fun/tags/%E5%9F%9F%E5%90%8D%E9%82%AE%E7%AE%B1/"},{"name":"ä¼ä¸šé‚®ç®±","slug":"ä¼ä¸šé‚®ç®±","permalink":"https://blog.mitt.fun/tags/%E4%BC%81%E4%B8%9A%E9%82%AE%E7%AE%B1/"},{"name":"GEODNS","slug":"GEODNS","permalink":"https://blog.mitt.fun/tags/GEODNS/"},{"name":"åŒºåŸŸè§£æ","slug":"åŒºåŸŸè§£æ","permalink":"https://blog.mitt.fun/tags/%E5%8C%BA%E5%9F%9F%E8%A7%A3%E6%9E%90/"},{"name":"MXå…±å­˜","slug":"MXå…±å­˜","permalink":"https://blog.mitt.fun/tags/MX%E5%85%B1%E5%AD%98/"},{"name":"MX","slug":"MX","permalink":"https://blog.mitt.fun/tags/MX/"},{"name":"CNAME","slug":"CNAME","permalink":"https://blog.mitt.fun/tags/CNAME/"},{"name":"Dnspod","slug":"Dnspod","permalink":"https://blog.mitt.fun/tags/Dnspod/"},{"name":"ç™¾åº¦CDN","slug":"ç™¾åº¦CDN","permalink":"https://blog.mitt.fun/tags/%E7%99%BE%E5%BA%A6CDN/"},{"name":"Wireguard","slug":"Wireguard","permalink":"https://blog.mitt.fun/tags/Wireguard/"},{"name":"Kilo","slug":"Kilo","permalink":"https://blog.mitt.fun/tags/Kilo/"},{"name":"Peer2Peer","slug":"Peer2Peer","permalink":"https://blog.mitt.fun/tags/Peer2Peer/"},{"name":"Docker","slug":"Docker","permalink":"https://blog.mitt.fun/tags/Docker/"},{"name":"Milestone","slug":"Milestone","permalink":"https://blog.mitt.fun/tags/Milestone/"}]}